<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>Thoughts from the Café</title>
    <link href="http://stappit.github.io/atom.xml" rel="self" />
    <link href="http://stappit.github.io" />
    <id>http://stappit.github.io/atom.xml</id>
    <author>
        <name>Brian</name>
        <email>ha@hahaha.com</email>
    </author>
    <updated>2018-10-06T00:00:00Z</updated>
    <entry>
    <title>BDA3 Chapter 3 Exercise 5</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_03_exercise_05.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_03_exercise_05.html</id>
    <published>2018-10-06T00:00:00Z</published>
    <updated>2018-10-06T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 3 Exercise 5</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on October  6, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%203.html">bda chapter 3</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/rounding%20error.html">rounding error</a>, <a href="/tags/marginal%20posterior.html">marginal posterior</a>, <a href="/tags/measurement%20error.html">measurement error</a>, <a href="/tags/noninformative%20prior.html">noninformative prior</a>, <a href="/tags/normal.html">normal</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 5, chapter 3, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial} \DeclareMathOperator{\dbern}{Bernoulli} \DeclareMathOperator{\dpois}{Poisson} \DeclareMathOperator{\dnorm}{Normal} \DeclareMathOperator{\dt}{t} \DeclareMathOperator{\dcauchy}{Cauchy} \DeclareMathOperator{\dexponential}{Exp} \DeclareMathOperator{\duniform}{Uniform} \DeclareMathOperator{\dgamma}{Gamma} \DeclareMathOperator{\dinvgamma}{InvGamma} \DeclareMathOperator{\invlogit}{InvLogit} \DeclareMathOperator{\logit}{Logit} \DeclareMathOperator{\ddirichlet}{Dirichlet} \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Suppose we weigh an object 5 times with measurements</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">measurements &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">11</span>, <span class="dv">9</span>)</code></pre></div>
<p>all rounded to the nearest kilogram. Assuming the unrounded measurements are normally distributed, we wish to estimate the weight of the object. We will use the uniform non-informative prior <span class="math inline">\(p(\mu, \log \sigma) \propto 1\)</span>.</p>
<p>First, let’s assume the measurments are not rounded. Then the marginal posterior mean is <span class="math inline">\(\mu \mid y \sim t_{n - 1}(\bar y, s / \sqrt{n}) = t_4(10.4, 0.51)\)</span>.</p>
<figure>
<img src="chapter_03_exercise_05_files/figure-markdown/mpm_plot-1..svg" />
</figure>
<p>Now, let’s find the posterior assuming rounded measurements. The probability of getting the rounded measurements <span class="math inline">\(y\)</span> is</p>
<p class="mathjaxWide"><span class="math display">\[
p(y \mid \mu, \sigma) = \prod_{i = 1}^n \Phi_{\mu, \sigma} (y_i + 0.5) - \Phi_{\mu, \sigma} (y_i - 0.5)
\]</span></p>
<p>where <span class="math inline">\(\Phi_{\mu, \sigma}\)</span> is the CDF of the <span class="math inline">\(\dnorm(\mu, \sigma)\)</span> distribution. This implies that the posterior is</p>
<p class="mathjaxWide"><span class="math display">\[
p(\mu, \sigma \mid y) \propto \frac{1}{\sigma^2} \prod_{i = 1}^n \Phi_{\mu, \sigma} (y_i + 0.5) - \Phi_{\mu, \sigma} (y_i - 0.5) .
\]</span></p>
<p>Calculating this marginal posterior mean is pretty difficult, so we’ll use <a href="http://mc-stan.org/">Stan</a> to draw samples. My <a href="src/ex_03_05.stan">first attempt</a> at writing the model was a direct translation of the maths above. However, it doesn’t allow us to infer the unrounded values, as required in part d. The model can be expressed differently by considering the unrounded values as uniformly distributed around the rounded values, i.e. <span class="math inline">\(z_i \sim \duniform (y_i - 0.5, y_i + 0.5)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model &lt;-<span class="st"> </span>rstan<span class="op">::</span><span class="kw">stan_model</span>(<span class="st">&#39;src/ex_03_05_d.stan&#39;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model</code></pre></div>
<pre><code>S4 class stanmodel &#39;ex_03_05_d&#39; coded as follows:
data {
  int&lt;lower = 1&gt; n;
  vector[n] y; // rounded measurements
}

parameters {
  real mu; // &#39;true&#39; weight of the object
  real&lt;lower = 0&gt; sigma; // measurement error
  vector&lt;lower = -0.5, upper = 0.5&gt;[n] err; // rounding error
}

transformed parameters {
  // unrounded values are the rounded values plus some rounding error
  vector[n] z = y + err; // unrounded measurements
}

model {
  target += -2 * log(sigma); // prior
  z ~ normal(mu, sigma);
  // other parameters are uniform
} </code></pre>
<p>Note that Stan assumes parameters are uniform on their range unless specified otherwise.</p>
<p>Let’s also load a model that assumes the measurements are unrounded.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_unrounded &lt;-<span class="st"> </span>rstan<span class="op">::</span><span class="kw">stan_model</span>(<span class="st">&#39;src/ex_03_05_unrounded.stan&#39;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_unrounded</code></pre></div>
<pre><code>S4 class stanmodel &#39;ex_03_05_unrounded&#39; coded as follows:
data {
  int&lt;lower = 1&gt; n;
  vector[n] y; 
}

parameters {
  real mu; 
  real&lt;lower = 0&gt; sigma; 
}

model {
  target += -2 * log(sigma); 
  y ~ normal(mu, sigma);
} </code></pre>
<p>Now we can fit the models to the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data  =<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">n =</span> <span class="kw">length</span>(measurements),
  <span class="dt">y =</span> measurements
)
 
fit &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>rstan<span class="op">::</span><span class="kw">sampling</span>(
    <span class="dt">data =</span> data,
    <span class="dt">warmup =</span> <span class="dv">1000</span>,
    <span class="dt">iter =</span> <span class="dv">5000</span>
  ) 

fit_unrounded &lt;-<span class="st"> </span>model_unrounded <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>rstan<span class="op">::</span><span class="kw">sampling</span>(
    <span class="dt">data =</span> data,
    <span class="dt">warmup =</span> <span class="dv">1000</span>,
    <span class="dt">iter =</span> <span class="dv">5000</span>
  ) </code></pre></div>
<p>We’ll also need some draws from the posteriors to make our comparisons.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">draws &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>tidybayes<span class="op">::</span><span class="kw">spread_draws</span>(mu, sigma, z[index]) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># spread out z&#39;s so that</span>
<span class="st">  </span><span class="co"># there is one row per draw</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">index =</span> <span class="kw">paste0</span>(<span class="st">&#39;z&#39;</span>, <span class="kw">as.character</span>(index)),
    <span class="dt">model =</span> <span class="st">&#39;rounded&#39;</span>
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(index, z)

draws_unrounded &lt;-<span class="st"> </span>fit_unrounded <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>tidybayes<span class="op">::</span><span class="kw">spread_draws</span>(mu, sigma) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">&#39;unrounded&#39;</span>) 

draws_all &lt;-<span class="st"> </span>draws <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_rows</span>(draws_unrounded)</code></pre></div>
<table class="table table-striped table-hover table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
First few draws from each model
</caption>
<thead>
<tr>
<th style="text-align:right;">
mu
</th>
<th style="text-align:right;">
sigma
</th>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
z1
</th>
<th style="text-align:right;">
z2
</th>
<th style="text-align:right;">
z3
</th>
<th style="text-align:right;">
z4
</th>
<th style="text-align:right;">
z5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
9.687131
</td>
<td style="text-align:right;">
1.4458022
</td>
<td style="text-align:left;">
rounded
</td>
<td style="text-align:right;">
9.72795
</td>
<td style="text-align:right;">
10.265646
</td>
<td style="text-align:right;">
11.94897
</td>
<td style="text-align:right;">
11.06143
</td>
<td style="text-align:right;">
9.116118
</td>
</tr>
<tr>
<td style="text-align:right;">
10.517837
</td>
<td style="text-align:right;">
0.5648234
</td>
<td style="text-align:left;">
rounded
</td>
<td style="text-align:right;">
10.33178
</td>
<td style="text-align:right;">
9.797315
</td>
<td style="text-align:right;">
11.54332
</td>
<td style="text-align:right;">
10.60547
</td>
<td style="text-align:right;">
9.153462
</td>
</tr>
<tr>
<td style="text-align:right;">
11.381591
</td>
<td style="text-align:right;">
2.1127547
</td>
<td style="text-align:left;">
rounded
</td>
<td style="text-align:right;">
10.09489
</td>
<td style="text-align:right;">
10.176548
</td>
<td style="text-align:right;">
12.44288
</td>
<td style="text-align:right;">
10.92263
</td>
<td style="text-align:right;">
8.700090
</td>
</tr>
<tr>
<td style="text-align:right;">
9.965578
</td>
<td style="text-align:right;">
1.2079231
</td>
<td style="text-align:left;">
unrounded
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
10.062636
</td>
<td style="text-align:right;">
1.2355530
</td>
<td style="text-align:left;">
unrounded
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
9.922399
</td>
<td style="text-align:right;">
1.7637659
</td>
<td style="text-align:left;">
unrounded
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<p>The contour plots look very similar but with <span class="math inline">\(\sigma\)</span> shifted upward when we treat the observations as unrounded measurements. This is contrary to my intuition about what should happen: by introducing uncertainty into our measurments, I would have thought we’d see more uncertainty in our parameter estimates.</p>
<figure>
<img src="chapter_03_exercise_05_files/figure-markdown/contour_plot-1..svg" />
</figure>
<p>The density for <span class="math inline">\(\mu \mid y\)</span> look much the same in both models. This is expected because the rounded measurement is the mean of all possible unrounded measurements.</p>
<figure>
<img src="chapter_03_exercise_05_files/figure-markdown/mu_plot-1..svg" />
</figure>
<p>The marginal posterior for <span class="math inline">\(\sigma\)</span> again shows a decrease when taking rounding error into account. I’m not sure why that would happen.</p>
<figure>
<img src="chapter_03_exercise_05_files/figure-markdown/sigma_plot-1..svg" />
</figure>
<table class="table table-striped table-hover table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Quantiles for σ | y
</caption>
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
5%
</th>
<th style="text-align:right;">
50%
</th>
<th style="text-align:right;">
95%
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
rounded
</td>
<td style="text-align:right;">
0.6044134
</td>
<td style="text-align:right;">
1.025455
</td>
<td style="text-align:right;">
2.073181
</td>
</tr>
<tr>
<td style="text-align:left;">
unrounded
</td>
<td style="text-align:right;">
0.6804532
</td>
<td style="text-align:right;">
1.095101
</td>
<td style="text-align:right;">
2.133040
</td>
</tr>
</tbody>
</table>
<p>Finally, let’s calculate the posterior for <span class="math inline">\(\theta := (z_1 - z_2)^2\)</span> (assuming we observe rounded measurements).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims &lt;-<span class="st"> </span>draws <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">theta =</span> (z1 <span class="op">-</span><span class="st"> </span>z2)<span class="op">^</span><span class="dv">2</span>) </code></pre></div>
<figure>
<img src="chapter_03_exercise_05_files/figure-markdown/sims_plot-1..svg" />
</figure>
<p>There is a lot of mass near 0 because the observed rounded measurments are the same for <span class="math inline">\(z_1\)</span> and <span class="math inline">\(z_2\)</span>. The probability density is also entirely less than 1 because the rounding is off by at most 0.5 in any direction.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 3 Exercise 4</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_03_exercise_04.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_03_exercise_04.html</id>
    <published>2018-10-05T00:00:00Z</published>
    <updated>2018-10-05T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 3 Exercise 4</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on October  5, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%203.html">bda chapter 3</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/odds%20ratio.html">odds ratio</a>, <a href="/tags/noninformative%20priors.html">noninformative priors</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 4, chapter 3, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial} \DeclareMathOperator{\dbern}{Bernoulli} \DeclareMathOperator{\dpois}{Poisson} \DeclareMathOperator{\dnorm}{Normal} \DeclareMathOperator{\dt}{t} \DeclareMathOperator{\dcauchy}{Cauchy} \DeclareMathOperator{\dexponential}{Exp} \DeclareMathOperator{\dgamma}{Gamma} \DeclareMathOperator{\dinvgamma}{InvGamma} \DeclareMathOperator{\invlogit}{InvLogit} \DeclareMathOperator{\logit}{Logit} \DeclareMathOperator{\ddirichlet}{Dirichlet} \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Suppose we have two independent trials where the likelihood of death is binomial, <span class="math inline">\(y_i \mid p_0, p_1 \sim \dbinomial(n_i, p_i)\)</span>, <span class="math inline">\(i = 0, 1\)</span>. We will compare two different non-informative priors on the odds ratio</p>
<p class="mathjaxWide"><span class="math display">\[
\theta
:=
\frac{p_0}{1 - p_0} / \frac{p_1}{1 - p_1} 
.
\]</span></p>
<p>Here are the given data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(
    <span class="dt">cohort =</span> <span class="kw">c</span>(<span class="st">&#39;control&#39;</span>, <span class="st">&#39;treatment&#39;</span>),
    <span class="dt">patients =</span> <span class="kw">c</span>(<span class="dv">674</span>, <span class="dv">680</span>),
    <span class="dt">deaths =</span> <span class="kw">c</span>(<span class="dv">39</span>, <span class="dv">22</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">survived =</span> patients <span class="op">-</span><span class="st"> </span>deaths)</code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
cohort
</th>
<th style="text-align:right;">
patients
</th>
<th style="text-align:right;">
deaths
</th>
<th style="text-align:right;">
survived
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
control
</td>
<td style="text-align:right;">
674
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
635
</td>
</tr>
<tr>
<td style="text-align:left;">
treatment
</td>
<td style="text-align:right;">
680
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
658
</td>
</tr>
</tbody>
</table>
<p>We’ll need a couple of functions for drawing random samples for <span class="math inline">\(\theta\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">odds &lt;-<span class="st"> </span><span class="cf">function</span>(p) p <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p)

simulate &lt;-<span class="st"> </span><span class="cf">function</span>(n, k, a, b, <span class="dt">draws =</span> <span class="dv">10000</span>)
  <span class="co"># draws from posterior</span>
  <span class="co"># n bernouille trials, k successes with beta(a, b) prior</span>
  <span class="kw">tibble</span>(
    <span class="dt">draw =</span> <span class="dv">1</span><span class="op">:</span>draws, 
    <span class="dt">value =</span> <span class="kw">rbeta</span>(draws, k <span class="op">+</span><span class="st"> </span>a, n <span class="op">-</span><span class="st"> </span>k <span class="op">+</span><span class="st"> </span>b)
  )

posterior &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, <span class="dt">draws =</span> <span class="dv">10000</span>)
  <span class="co"># random samples from theta posterior with beta(a, b) prior</span>
  df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">transmute</span>(
      cohort,
      <span class="dt">draws =</span> <span class="kw">map2</span>(patients, deaths, simulate, a, b, draws)
    ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">unnest</span>(draws) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">spread</span>(cohort, value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">theta =</span> <span class="kw">odds</span>(control) <span class="op">/</span><span class="st"> </span><span class="kw">odds</span>(treatment))</code></pre></div>
<p>Let’s compare a uniform prior to a prior close to <span class="math inline">\(\dbeta(0, 0)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uni &lt;-<span class="st"> </span><span class="kw">posterior</span>(<span class="dv">1</span>, <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="st">&#39;uniform&#39;</span>)

zero &lt;-<span class="st"> </span><span class="kw">posterior</span>(<span class="fl">0.000000001</span>, <span class="fl">0.000000001</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="st">&#39;zero&#39;</span>)

posteriors &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(uni, zero)</code></pre></div>
<figure>
<img src="chapter_03_exercise_04_files/figure-markdown/posteriors_plot-1..svg" />
</figure>
<p>Here are the 95% posterior credible intervals for <span class="math inline">\(\theta\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cis &lt;-<span class="st"> </span>posteriors <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(prior) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">q05 =</span> <span class="kw">quantile</span>(theta, <span class="fl">0.05</span>),
    <span class="dt">q50 =</span> <span class="kw">quantile</span>(theta, <span class="fl">0.5</span>),
    <span class="dt">q95 =</span> <span class="kw">quantile</span>(theta, <span class="fl">0.95</span>)
  )</code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
prior
</th>
<th style="text-align:right;">
q05
</th>
<th style="text-align:right;">
q50
</th>
<th style="text-align:right;">
q95
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
uniform
</td>
<td style="text-align:right;">
1.167356
</td>
<td style="text-align:right;">
1.808981
</td>
<td style="text-align:right;">
2.859778
</td>
</tr>
<tr>
<td style="text-align:left;">
zero
</td>
<td style="text-align:right;">
1.190899
</td>
<td style="text-align:right;">
1.845182
</td>
<td style="text-align:right;">
2.939430
</td>
</tr>
</tbody>
</table>
<p>The estimates with the “zero” prior are slightly higher than those from the uniform prior, especially in the tails.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 3 Exercise 3</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_03_exercise_03.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_03_exercise_03.html</id>
    <published>2018-10-04T00:00:00Z</published>
    <updated>2018-10-04T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 3 Exercise 3</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on October  4, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%203.html">bda chapter 3</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/normal.html">normal</a>, <a href="/tags/t.html">t</a>, <a href="/tags/behrens-fischer.html">behrens-fischer</a>, <a href="/tags/marginal%0Aposterior.html">marginal
posterior</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 3, chapter 3, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial} \DeclareMathOperator{\dbern}{Bernoulli} \DeclareMathOperator{\dpois}{Poisson} \DeclareMathOperator{\dnorm}{Normal} \DeclareMathOperator{\dt}{t} \DeclareMathOperator{\dcauchy}{Cauchy} \DeclareMathOperator{\dexponential}{Exp} \DeclareMathOperator{\dgamma}{Gamma} \DeclareMathOperator{\dinvgamma}{InvGamma} \DeclareMathOperator{\invlogit}{InvLogit} \DeclareMathOperator{\logit}{Logit} \DeclareMathOperator{\ddirichlet}{Dirichlet} \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Suppose we have <span class="math inline">\(n\)</span> measurements <span class="math inline">\(y \mid \mu, \sigma \sim \dnorm(\mu, \sigma)\)</span>, where the prior <span class="math inline">\(p(\mu, \log \sigma) \propto 1\)</span> is uniform. The calculations on page 66 show that the marginal posterior distribution of <span class="math inline">\(\mu\)</span> is <span class="math inline">\(\mu \mid y \sim \dt(\bar y, s / n)\)</span>, where <span class="math inline">\(s\)</span> is the sample standard deviation. The measurements are as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">control &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">n =</span> <span class="dv">32</span>,
  <span class="dt">mean =</span> <span class="fl">1.013</span>,
  <span class="dt">sd =</span> <span class="fl">0.24</span>
)

treatment &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">n =</span> <span class="dv">36</span>,
  <span class="dt">mean =</span> <span class="fl">1.173</span>,
  <span class="dt">sd =</span> <span class="fl">0.2</span>
)</code></pre></div>
<p>The t-distribution in base-R is a standardised t-distribution. For a more general t-distribution (with arbitrary location and scale), we’ll use the <a href="https://www.rdocumentation.org/packages/LaplacesDemon/versions/16.1.1">LaplacesDemon</a> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(LaplacesDemon)</code></pre></div>
<p>This allows us to plot the marginal posterior means.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mp &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">value =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="fl">0.01</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">ctrl =</span> <span class="kw">dst</span>(value, control<span class="op">$</span>mean, control<span class="op">$</span>sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(control<span class="op">$</span>n), control<span class="op">$</span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>),
    <span class="dt">trt =</span> <span class="kw">dst</span>(value, treatment<span class="op">$</span>mean, treatment<span class="op">$</span>sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(treatment<span class="op">$</span>n), treatment<span class="op">$</span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(cohort, density, ctrl, trt) </code></pre></div>
<figure>
<img src="chapter_03_exercise_03_files/figure-markdown/mp_plot-1.png" />
</figure>
<p>The 95% credible interval of the marginal posterior means is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">draws &lt;-<span class="st"> </span><span class="dv">10000</span>

difference &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">draw =</span> <span class="dv">1</span><span class="op">:</span>draws) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">ctrl =</span> <span class="kw">rst</span>(<span class="kw">n</span>(), control<span class="op">$</span>mean, control<span class="op">$</span>sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(control<span class="op">$</span>n), control<span class="op">$</span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>),
    <span class="dt">trt =</span> <span class="kw">rst</span>(<span class="kw">n</span>(), treatment<span class="op">$</span>mean, treatment<span class="op">$</span>sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(treatment<span class="op">$</span>n), treatment<span class="op">$</span>n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>),
    <span class="dt">difference =</span> trt <span class="op">-</span><span class="st"> </span>ctrl
  ) 

ci &lt;-<span class="st"> </span>difference<span class="op">$</span>difference <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">quantile</span>(<span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>)) 

ci</code></pre></div>
<pre><code>        5%        95% 
0.06998355 0.25134861 </code></pre>
<p>We can also plot the distribution of the difference.</p>
<figure>
<img src="chapter_03_exercise_03_files/figure-markdown/diffs_plot-1.png" />
</figure>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 3 Exercise 2</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_03_exercise_02.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_03_exercise_02.html</id>
    <published>2018-09-15T00:00:00Z</published>
    <updated>2018-09-15T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 3 Exercise 2</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September 15, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%203.html">bda chapter 3</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/multinomial.html">multinomial</a>, <a href="/tags/dirichlet.html">dirichlet</a>, <a href="/tags/beta.html">beta</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 2, chapter 3, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial} \DeclareMathOperator{\dbern}{Bernoulli} \DeclareMathOperator{\dpois}{Poisson} \DeclareMathOperator{\dnorm}{Normal} \DeclareMathOperator{\dcauchy}{Cauchy} \DeclareMathOperator{\dexponential}{Exp} \DeclareMathOperator{\dgamma}{Gamma} \DeclareMathOperator{\dinvgamma}{InvGamma} \DeclareMathOperator{\invlogit}{InvLogit} \DeclareMathOperator{\logit}{Logit} \DeclareMathOperator{\ddirichlet}{Dirichlet} \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<table class="table table-striped table-hover table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
survey
</th>
<th style="text-align:right;">
bush
</th>
<th style="text-align:right;">
dukakis
</th>
<th style="text-align:right;">
other
</th>
<th style="text-align:right;">
total
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
pre-debate
</td>
<td style="text-align:right;">
294
</td>
<td style="text-align:right;">
307
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
639
</td>
</tr>
<tr>
<td style="text-align:left;">
post-debate
</td>
<td style="text-align:right;">
288
</td>
<td style="text-align:right;">
332
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
639
</td>
</tr>
</tbody>
</table>
<p>Let <span class="math inline">\(\theta_\text{pre} \sim \ddirichlet_3(\alpha_\text{pre})\)</span> and <span class="math inline">\(\theta_\text{post} \sim \ddirichlet_3(\alpha_\text{post})\)</span> be the pre- and post-debate priors. Then the posteriors are</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  \theta_\text{pre} \mid y &amp;\sim \ddirichlet\left(294 + \alpha_{(\text{pre}, \text{b})}, 307 + \alpha_{(\text{pre}, \text{d})}, 38 + \alpha_{(\text{pre}, \text{o})} \right)
  \\
  \theta_\text{post} \mid y &amp;\sim \ddirichlet\left(288 + \alpha_{(\text{post}, \text{b})}, 332 + \alpha_{(\text{post}, \text{d})}, 19 + \alpha_{(\text{post}, \text{o})} \right)
.
\end{align}
\]</span></p>
<p>Denote the proportion of support for Bush amongst Bush/Dukakis supporters by <span class="math inline">\(\phi_\bullet := \frac{\theta_{(\bullet, \text{b})}}{\theta_{(\bullet, \text{b})} + \theta_{(\bullet, \text{d})}}\)</span>. The results of the <a href="./chapter_03_exercise_01.html">previous exercise</a> show that we can treat this as a beta-binomial problem by simply ignoring the results for <code>other</code>. More precisely,</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  \phi_\text{pre} \mid y &amp;\sim \dbeta\left(294 + \alpha_{(\text{pre}, \text{b})}, 307 + \alpha_{(\text{pre}, \text{d})} \right)
  \\
  \phi_\text{post} \mid y &amp;\sim \dbeta\left(288 + \alpha_{(\text{post}, \text{b})}, 332 + \alpha_{(\text{post}, \text{d})} \right)
\end{align}
.
\]</span></p>
<p>Let’s plot these posteriors and their difference <span class="math inline">\(\delta := (\phi_\text{post} \mid y) - (\phi_\text{pre} \mid y)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alpha_bush &lt;-<span class="st"> </span><span class="dv">1</span>
alpha_dukakis &lt;-<span class="st"> </span><span class="dv">1</span>

posteriors &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(
    <span class="dt">value =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>),
    <span class="dt">survey =</span> df<span class="op">$</span>survey
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(df, <span class="dt">by =</span> <span class="st">&#39;survey&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">post_bush =</span> bush <span class="op">+</span><span class="st"> </span>alpha_bush,
    <span class="dt">post_dukakis =</span> dukakis <span class="op">+</span><span class="st"> </span>alpha_dukakis,
    <span class="dt">density =</span> <span class="kw">dbeta</span>(value, post_bush, post_dukakis)
  ) </code></pre></div>
<figure>
<img src="chapter_03_exercise_02_files/figure-markdown/posteriors_plot-1..svg" />
</figure>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="dv">10000</span>

shift &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(
    <span class="dt">draw =</span> <span class="dv">1</span><span class="op">:</span>N, 
    <span class="dt">survey =</span> df<span class="op">$</span>survey
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(df, <span class="dt">by =</span> <span class="st">&#39;survey&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">post_bush =</span> bush <span class="op">+</span><span class="st"> </span>alpha_bush,
    <span class="dt">post_dukakis =</span> dukakis <span class="op">+</span><span class="st"> </span>alpha_dukakis,
    <span class="dt">value =</span> <span class="kw">rbeta</span>(<span class="kw">n</span>(), post_bush, post_dukakis)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(draw, survey, value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(survey, value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">difference =</span> <span class="st">`</span><span class="dt">post-debate</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">pre-debate</span><span class="st">`</span>) </code></pre></div>
<figure>
<img src="chapter_03_exercise_02_files/figure-markdown/shift_plot-1..svg" />
</figure>
<p>There is a 19.1% probability (the area above 0) that there was a positive shift towards Bush.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 3 Exercise 1</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_03_exercise_01.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_03_exercise_01.html</id>
    <published>2018-09-14T00:00:00Z</published>
    <updated>2018-09-14T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 3 Exercise 1</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September 14, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%203.html">bda chapter 3</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/multinomial.html">multinomial</a>, <a href="/tags/dirichlet.html">dirichlet</a>, <a href="/tags/change%20of%20variables.html">change of variables</a>, <a href="/tags/beta.html">beta</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 1, chapter 3, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial}  \DeclareMathOperator{\dmultinomial}{Multinomial}  \DeclareMathOperator{\dbern}{Bernoulli}  \DeclareMathOperator{\dpois}{Poisson}  \DeclareMathOperator{\dnorm}{Normal}  \DeclareMathOperator{\dcauchy}{Cauchy}  \DeclareMathOperator{\dexponential}{Exp}  \DeclareMathOperator{\ddirichlet}{Dirichlet}  \DeclareMathOperator{\dgamma}{Gamma}  \DeclareMathOperator{\dinvgamma}{InvGamma}  \DeclareMathOperator{\invlogit}{InvLogit}  \DeclareMathOperator{\logit}{Logit}  \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Let <span class="math inline">\(y \mid \theta \sim \dmultinomial_J(\theta)\)</span> with prior <span class="math inline">\(\theta \sim \ddirichlet_J(\alpha)\)</span>. We would like to find the marginal distribution of <span class="math inline">\(\phi := \frac{\theta_1}{\theta_1 + \theta_2}\)</span>.</p>
<h2 id="marginal-posterior-of-dirichlet-multinomial">Marginal posterior of Dirichlet-multinomial</h2>
<p>As shown in the book, the posterior is <span class="math inline">\(\theta \mid y \sim \ddirichlet(y + \alpha)\)</span>. The marginal posterior of <span class="math inline">\((\theta_1, \theta_2) \mid y\)</span> can be written as</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\theta_1, \theta_2 \mid y)
  &amp;=
  \int_0^1 p(\theta \mid y) d\theta_3 \dotsm d\theta_{J - 1}
  \\
  &amp;\propto
  \theta_1^{y_1 + \alpha_1 - 1}\theta_2^{y_2 + \alpha_2 - 1}
  \int_0^1 \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 1}^{y_{J - 1} + \alpha_{J - 1} - 1} 
  \left(1 - \sum_1^{J - 1} \theta_j \right)^{y_J + \alpha_J - 1} d\theta_3 \dotsm d\theta_{J - 1}
  .
\end{align}
\]</span></p>
<p>The tricky part is calculating the integral part, which we define</p>
<p class="mathjaxWide"><span class="math display">\[
I 
:=
\int_0^1 \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 1}^{y_{J - 1} + \alpha_{J - 1} - 1} 
\left(1 - \sum_1^{J - 1} \theta_j \right)^{y_J + \alpha_J - 1} d\theta_3 \dotsm d\theta_{J - 1}
.
\]</span></p>
<p>To calculate <span class="math inline">\(I\)</span>, first note that</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  \int_0^1 \theta^s \left( c - \theta \right)^t d\theta 
  &amp;=
  \int_0^1 \theta^s \left( 1 - \frac{\theta}{c} \right)^t c^t d\theta 
  \\
  &amp;=
  \int_0^1 \left( \frac{\theta}{c} \right)^s \left( 1 - \frac{\theta}{c} \right)^t c^{s + t} d\theta 
  \\
  &amp;=
  \int_0^1 \phi^s \left( 1 - \phi \right)^t c^{s + t + 1} d\phi
  ,
  \quad 
  \phi := \frac{\theta}{c}
  \\
  &amp;=
  B(s + 1, t + 1) c^{s + t + 1} 
  ,
\end{align}
\]</span></p>
<p>if <span class="math inline">\(c\)</span> is not a function of <span class="math inline">\(\theta\)</span>. With <span class="math inline">\(c := 1 - \sum_1^{J - 2} \theta_j\)</span>,</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  I
  &amp;=
  \int_0^1 
  \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 2}^{y_{J - 2} + \alpha_{J - 2} - 1} 
  \theta_{J - 1}^{y_{J - 1} + \alpha_{J - 1} - 1} 
  \left(
    1 - \sum_1^{J - 2} \theta_j - \theta_{J - 1} 
  \right)^{y_J + \alpha_J - 1} 
  d\theta_3 \dotsm d\theta_{J - 1}
  \\
  &amp;=
  \int_0^1 
  \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 2}^{y_{J - 2} + \alpha_{J - 2} - 1}
  \left(
  \int_0^1 
    \theta_{J - 1}^{y_{J - 1} + \alpha_{J - 1} - 1} 
    \left(c - \theta_{J - 1} \right)^{y_J + \alpha_J - 1} 
  d\theta_{J - 1} \right) d\theta_3 \dotsm d\theta_{J - 2}
  \\
  &amp;\propto
  \int_0^1 
  \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 2}^{y_{J - 2} + \alpha_{J - 2} - 1}
  \left( c \right)^{y_{J-1} + y_J + \alpha_{J-1} + \alpha_J - 1}
  d\theta_3 \dotsm d\theta_{J - 2}
  \\
  &amp;=
  \int_0^1 
  \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 2}^{y_{J - 2} + \alpha_{J - 2} - 1}
  \left( 1 - \sum_1^{J-2} \theta_j \right)^{y_{J-1} + y_J + \alpha_{J-1} + \alpha_J - 1}
  d\theta_3 \dotsm d\theta_{J - 2}
  .
\end{align}
\]</span></p>
<p>Continuing by induction,</p>
<p class="mathjaxWide"><span class="math display">\[
I
=
\left(
  1 - \theta_1 - \theta_2
\right) ^ {\sum_3^J (y_j + \alpha_j) - 1}
.
\]</span></p>
<p>Now that we have the integral part, the marginal posterior can be written</p>
<p class="mathjaxWide"><span class="math display">\[
p(\theta_1, \theta_2 \mid y)
\propto
\theta_1^{y_1 + \alpha_1 - 1}\theta_2^{y_2 + \alpha_2 - 1}
\left(
  1 - \theta_1 - \theta_2
\right) ^ {\sum_3^J (y_j + \alpha_j) - 1}
.
\]</span></p>
<p>This has the form of a Dirichlet distribution, so the marginal posterior is</p>
<p class="mathjaxWide"><span class="math display">\[
\left( \theta_1, \theta_2, 1 - \theta_1 - \theta_2 \right) \mid y
\sim
\ddirichlet\left(y_1 + \alpha_1, y_2 + \alpha_2, \sum_3^J (y_j + \alpha_j) \right)
.
\]</span></p>
<h2 id="change-of-variables">Change of variables</h2>
<p>Now define <span class="math inline">\((\phi_1, \phi_2) := (\frac{\theta_1}{\theta_1 + \theta_2}, \theta_1 + \theta_2)\)</span>, so that <span class="math inline">\((\theta_1, \theta_2) = (\phi_1\phi_2, \phi_2 - \phi_1\phi_2)\)</span>. The Jacobian of this transformation is</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{vmatrix}
  \frac{\partial\theta_1}{\partial\phi_1} &amp; \frac{\partial\theta_1}{\partial\phi_2} \\
  \frac{\partial\theta_2}{\partial\phi_1} &amp; \frac{\partial\theta_2}{\partial\phi_2} 
\end{vmatrix}
=
\begin{vmatrix}
  \phi_2 &amp; \phi_1 \\
  -\phi_2 &amp; 1 - \phi_1
\end{vmatrix}
=
\phi_2
.
\]</span></p>
<p>Therefore, the probability distribution of the new variables is</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\phi_1, \phi_2 \mid y)
  &amp;=
  (\phi_1\phi_2)^{y_1 + \alpha_1 - 1} (\phi_2 (1 - \phi_1))^{y_2 + \alpha_2 - 1} (1 - \phi_2)^{\sum_3^J (y_j + \alpha_j) - 1} \frac{1}{\phi_2}
  \\
  &amp;=
  \phi_1^{y_1 + \alpha_1 - 1} (1 - \phi_1)^{y_2 + \alpha_2 - 1}
  \phi_2^{y_1 + y_2 + \alpha_1 + \alpha_2 - 3} (1 - \phi_2)^{\sum_3^J (y_j + \alpha_j) - 1}
  \\
  &amp;=
  p(\phi_1 \mid y) p(\phi_2 \mid y)
  ,
\end{align}
\]</span></p>
<p>where</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
\phi_1 \mid y &amp;\sim \dbeta(y_1 + \alpha_1, y_2 + \alpha_2 )
\\
\phi_2 \mid y &amp;\sim \dbeta\left(y_1 + y_2 + \alpha_1 + \alpha_2 - 2, \sum_3^J (y_j + \alpha_j)\right)
.
\end{align}
\]</span></p>
<p>The marginal posterior for <span class="math inline">\(\phi_1\)</span> is equivalent to the posterior obtained from a <span class="math inline">\(\phi_1 \sim \dbeta(\alpha_1, \alpha_2)\)</span> prior with a <span class="math inline">\(y_1 \mid \phi_1 \sim \dbinomial(y_1 + y_2, \phi_1)\)</span> likelihood.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 22</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_22.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_22.html</id>
    <published>2018-09-09T00:00:00Z</published>
    <updated>2018-09-09T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 22</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  9, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/basketball.html">basketball</a>, <a href="/tags/prior%20choice.html">prior choice</a>, <a href="/tags/weakly%0Ainformative%20prior.html">weakly
informative prior</a>, <a href="/tags/noninformative%20prior.html">noninformative prior</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 22, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial} \DeclareMathOperator{\dbern}{Bernoulli} \DeclareMathOperator{\dpois}{Poisson} \DeclareMathOperator{\dnorm}{Normal} \DeclareMathOperator{\dcauchy}{Cauchy} \DeclareMathOperator{\dexponential}{Exp} \DeclareMathOperator{\dgamma}{Gamma} \DeclareMathOperator{\dinvgamma}{InvGamma} \DeclareMathOperator{\invlogit}{InvLogit} \DeclareMathOperator{\logit}{Logit} \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Suppose you have a random sample of 100 college students in a basketball study. Each student takes 100 free-throws to establish a baseline success probability, <span class="math inline">\(\phi_0\)</span>. The students then take 50 practice free-throws per day for a month. After this month is up, each takes 100 shots for a final measurement of success probability, <span class="math inline">\(\phi_1\)</span>. We wish to estimate the increase in success probability, <span class="math inline">\(\theta := \phi_1 - \phi_0\)</span>.</p>
<p>We could use the uniform distribution on the range of theoretically possible values <span class="math inline">\([-1, 1]\)</span> as a ‘non-informative’ prior, i.e. every level of increase is equally likely.</p>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/noninformative_prior-1..svg" />
</figure>
<p>To construct an informative prior, I had to do a bit of background reading as I have next to zero basketball knowledge. After some google-fu, it seems the <a href="https://www.basketball-reference.com/leaders/ft_pct_career.html">best of the best</a> have a free-throw success rate of around 80-90%, and the <a href="https://abcnews.go.com/Sports/free-throws-easy-consequences-failing/story?id=40769445">worst of the best</a> around 50-60%. This latter estimate probably lies on the upper extreme for random college students. From watching some <a href="https://www.youtube.com/watch?v=LFF6_5hyokU">free throw videos</a>, I would guess that I would have a success rate of about 10% (baseline).</p>
<p>Let’s model the baseline average as beta distributed around a mean of 10% and upper extreme below 40%.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu0 &lt;-<span class="st"> </span><span class="fl">0.10</span>
n0 &lt;-<span class="st"> </span><span class="dv">15</span>

alpha0 &lt;-<span class="st"> </span>mu0 <span class="op">*</span><span class="st"> </span>n0
beta0 &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu0) <span class="op">*</span><span class="st"> </span>n0

<span class="kw">tibble</span>(
    <span class="dt">p =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>),
    <span class="dt">density =</span> <span class="kw">dbeta</span>(p, alpha0, beta0)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">aes</span>(p, density) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;white&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Average baseline success probability&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Density&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Baseline success probability simulation&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Beta({alpha0}, {beta0})&#39;</span>)
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/baseline_simulation-1..svg" />
</figure>
<p>With this assumption, there is a 0.286% chance of an average above 40%.</p>
<p>For the final estimate, the improvement could be quite significant given that random students are likely untrained (the better you get, the harder it is to improve). An average 15%% improvement seems plausible to me.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu1 &lt;-<span class="st"> </span>mu0 <span class="op">+</span><span class="st"> </span><span class="fl">0.15</span>
n1 &lt;-<span class="st"> </span><span class="dv">20</span>

alpha1 &lt;-<span class="st"> </span>mu1 <span class="op">*</span><span class="st"> </span>n1
beta1 &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu1) <span class="op">*</span><span class="st"> </span>n1

<span class="kw">tibble</span>(
    <span class="dt">p =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>),
    <span class="dt">density =</span> <span class="kw">dbeta</span>(p, alpha1, beta1)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">aes</span>(p, density) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;white&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Average final success probability&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Density&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Final success probability simulation&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Beta({alpha1}, {beta1})&#39;</span>)
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/final_simulation-1..svg" />
</figure>
<p>With the above assumptions, the distribution of the average increase is shown below. The bulk of the mass is above 0, which makes sense as most should improve through practice. There is also some chance of a decrease, with -25%% being fairly extreme.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">increase &lt;-<span class="st"> </span><span class="kw">tibble</span>(
    <span class="dt">phi0 =</span> <span class="kw">rbeta</span>(<span class="dv">10000</span>, alpha0, beta0),
    <span class="dt">phi1 =</span> <span class="kw">rbeta</span>(<span class="dv">10000</span>, alpha1, beta1),
    <span class="dt">theta =</span> phi1 <span class="op">-</span><span class="st"> </span>phi0
  ) 

increase <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">aes</span>(theta) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">colour =</span> <span class="st">&#39;dark orange&#39;</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Average increase in success probability (percentage points)&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Count&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Average increase in success probability simulation&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Beta({alpha1}, {beta1}) - Beta({alpha0}, {beta0})&#39;</span>)
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/increase_simulation-1..svg" />
</figure>
<p>We could approximate this as a beta distribution on <span class="math inline">\([-1, 1]\)</span> to ensure the prior is bounded. In this case, we can probably get away with using a normal distribution since the probability of exceeding the bounds is negligible.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu &lt;-<span class="st"> </span>mu1 <span class="op">-</span><span class="st"> </span>mu0
sigma &lt;-<span class="st"> </span><span class="kw">sd</span>(increase<span class="op">$</span>theta)

<span class="kw">tibble</span>(
    <span class="dt">theta =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.01</span>),
    <span class="dt">density =</span> <span class="kw">dnorm</span>(theta, mu, sigma)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(theta, density) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;white&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">colour =</span> <span class="st">&#39;dark orange&#39;</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Average increase in success probability (percentage points)&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Density&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Strongly informative prior&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Normal(μ = {signif(mu, digits = 2)}, σ = {signif(sigma, digits = 2)})&#39;</span>)
  ) <span class="op">+</span>
<span class="st">  </span><span class="ot">NULL</span></code></pre></div>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/informative_prior-1..svg" />
</figure>
<p>The probability that this normal distribution exceeds 1 is 0.000000000104%. A subjective prior for the average increase in success probability would thus be a <span class="math inline">\(\dnorm(0.15, 0.12)\)</span> prior.</p>
<p>Finally, let’s construct a weakly informative prior. We’ll again use the beta distribution scaled to the interval <span class="math inline">\([-1, 1]\)</span>, with a mean of 0 so that an increase can be entirely attributed to the data and not to the prior. Since the best of the pros have a success probability around 90%, we’d expect the increase of 100 random students to be below this value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alpha &lt;-<span class="st"> </span><span class="dv">5</span>
beta &lt;-<span class="st"> </span><span class="dv">5</span>

<span class="kw">tibble</span>(
    <span class="dt">theta =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.01</span>),
    <span class="dt">density =</span> <span class="kw">dbeta</span>(<span class="fl">0.5</span> <span class="op">+</span><span class="st"> </span>theta <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, alpha, beta)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(theta, density) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;white&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">colour =</span> <span class="st">&#39;dark orange&#39;</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>), <span class="dt">labels =</span> percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Average increase in success probability (percentage points)&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Density&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Weakly informative prior&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Beta({alpha}, {beta})&#39;</span>)
  ) <span class="op">+</span>
<span class="st">  </span><span class="ot">NULL</span></code></pre></div>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/weakly_informative_prior-1..svg" />
</figure>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 21</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_21.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_21.html</id>
    <published>2018-09-09T00:00:00Z</published>
    <updated>2018-09-09T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 21</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  9, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/poisson.html">poisson</a>, <a href="/tags/gamma.html">gamma</a>, <a href="/tags/exposure.html">exposure</a>, <a href="/tags/election.html">election</a>, <a href="/tags/usa.html">usa</a>, <a href="/tags/obama.html">obama</a>, <a href="/tags/pew%20research%20center.html">pew research center</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 21, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial} \DeclareMathOperator{\dbern}{Bernoulli} \DeclareMathOperator{\dpois}{Poisson} \DeclareMathOperator{\dnorm}{Normal} \DeclareMathOperator{\dcauchy}{Cauchy} \DeclareMathOperator{\dexponential}{Exp} \DeclareMathOperator{\dgamma}{Gamma} \DeclareMathOperator{\dinvgamma}{InvGamma} \DeclareMathOperator{\invlogit}{InvLogit} \DeclareMathOperator{\logit}{Logit} \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>I wasn’t able to find any of the data for this question on the book’s website (as indicated in the book). However, the data are available on the <a href="http://www.people-press.org/2008/11/02/november-2008-election-weekend-survey/">Pew Research Center website</a>. I am unsure if the Pew version is the same as the version intended in the book.</p>
<h2 id="data-inspection">Data inspection</h2>
<h3 id="loading">Loading</h3>
<p>Unzipping the download into my local <code>data</code> directory gives three files of interest:</p>
<ul>
<li><p><code>ElectWkd08c.sav</code></p>
<p>The dataset in SPSS format.</p></li>
<li><p><code>ElecWknd08.que.doc</code></p>
<p>A description of the survey questions and their column names in the dataset.</p></li>
<li><p><code>readme.txt</code></p>
<p>A description of the columns in the dataset derived from the survey questions.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(foreign)

df0 &lt;-<span class="st"> </span><span class="kw">read.spss</span>(<span class="dt">file =</span> <span class="st">&#39;data/ElectWkd08c.sav&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>()

df0 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>()</code></pre></div>
<pre><code>[1] 3402</code></pre>
<p>There are many columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df0 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">colnames</span>()</code></pre></div>
<pre><code>  [1] &quot;psraid&quot;    &quot;attempt&quot;   &quot;fcall&quot;     &quot;refusal&quot;   &quot;int_date&quot; 
  [6] &quot;area&quot;      &quot;scregion&quot;  &quot;sfips&quot;     &quot;sstate&quot;    &quot;cdist&quot;    
 [11] &quot;msa&quot;       &quot;usr&quot;       &quot;usr1&quot;      &quot;sampzip&quot;   &quot;pdsgen&quot;   
 [16] &quot;pdsrace&quot;   &quot;zfips&quot;     &quot;zstate&quot;    &quot;zcregion&quot;  &quot;zdensity3&quot;
 [21] &quot;sdensity3&quot; &quot;file&quot;      &quot;sample&quot;    &quot;sex&quot;       &quot;qs1&quot;      
 [26] &quot;thought&quot;   &quot;q1&quot;        &quot;voter&quot;     &quot;regist&quot;    &quot;regicert&quot; 
 [31] &quot;planreg&quot;   &quot;precinct&quot;  &quot;q2&quot;        &quot;oftvote&quot;   &quot;where&quot;    
 [36] &quot;horse&quot;     &quot;q3&quot;        &quot;q3_1&quot;      &quot;q3_2&quot;      &quot;q3_3&quot;     
 [41] &quot;q3a&quot;       &quot;q3a_1&quot;     &quot;q3a_2&quot;     &quot;q3a_3&quot;     &quot;q3summ&quot;   
 [46] &quot;q3summ2&quot;   &quot;q3tot&quot;     &quot;q3atot&quot;    &quot;q3horse&quot;   &quot;q3b&quot;      
 [51] &quot;q3bfilt&quot;   &quot;q5&quot;        &quot;q6&quot;        &quot;swing&quot;     &quot;plan1&quot;    
 [56] &quot;plan2&quot;     &quot;plan3&quot;     &quot;q7&quot;        &quot;q8&quot;        &quot;q9&quot;       
 [61] &quot;q10a&quot;      &quot;q10b&quot;      &quot;q10c&quot;      &quot;q10d&quot;      &quot;q10e&quot;     
 [66] &quot;q10f&quot;      &quot;q10g&quot;      &quot;q10de&quot;     &quot;q11&quot;       &quot;q12&quot;      
 [71] &quot;q13&quot;       &quot;q14&quot;       &quot;q15&quot;       &quot;q15_1&quot;     &quot;q15_2&quot;    
 [76] &quot;q15_3&quot;     &quot;Q15tot&quot;    &quot;q16&quot;       &quot;q16a&quot;      &quot;q17&quot;      
 [81] &quot;age&quot;       &quot;recage&quot;    &quot;educ&quot;      &quot;receduc&quot;   &quot;hisp1&quot;    
 [86] &quot;race_1&quot;    &quot;race_2&quot;    &quot;race_3&quot;    &quot;race_4&quot;    &quot;racecmb&quot;  
 [91] &quot;racethn&quot;   &quot;marital&quot;   &quot;parent&quot;    &quot;relig&quot;     &quot;religos&quot;  
 [96] &quot;chr&quot;       &quot;born&quot;      &quot;attend&quot;    &quot;income&quot;    &quot;party&quot;    
[101] &quot;partyln&quot;   &quot;ideo&quot;      &quot;class&quot;     &quot;employ&quot;    &quot;pvote04a&quot; 
[106] &quot;pvote04b&quot;  &quot;primary&quot;   &quot;first1&quot;    &quot;first2&quot;    &quot;scale10&quot;  
[111] &quot;labor&quot;     &quot;ql1&quot;       &quot;ql2&quot;       &quot;qc1&quot;       &quot;qc2&quot;      
[116] &quot;zipcode&quot;   &quot;money10&quot;   &quot;website&quot;   &quot;isex&quot;      &quot;ihisp1&quot;   
[121] &quot;irace_1&quot;   &quot;irace_2&quot;   &quot;irace_3&quot;   &quot;irace_4&quot;   &quot;iraceth&quot;  
[126] &quot;iracecmb&quot;  &quot;regfinal&quot;  &quot;ballot&quot;    &quot;mccain&quot;    &quot;obama&quot;    
[131] &quot;sameday&quot;   &quot;battle&quot;    &quot;phoneuse&quot;  &quot;filter_$&quot;  &quot;lvs&quot;      
[136] &quot;lvswt67&quot;   &quot;llweight&quot;  &quot;coweight&quot;  &quot;wt_weth&quot;   &quot;wt_thfr&quot;  
[141] &quot;wt_frsa&quot;   &quot;wt_wefr&quot;   &quot;weight&quot;    &quot;unlvwt67&quot; </code></pre>
<h3 id="state">State</h3>
<p>For each state, we want to know how many label themselves as <code>Very liberal</code> and how many report supporting Obama. The state is given by the <code>sstate</code> column and doesn’t include Hawaii or Alaska.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df0 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(sstate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="kw">reorder</span>(sstate, n), n) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;State&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Respondents&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Responses by state&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;There are {df0 %&gt;% distinct(sstate) %&gt;% nrow()} states in the dataset&#39;</span>),
    <span class="dt">caption =</span> <span class="st">&#39;Source: http://www.people-press.org/2008/11/02/november-2008-election-weekend-survey/&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/state_count-1..svg" />
</figure>
<h3 id="ideology">Ideology</h3>
<p>Consulting the documentation, we see that liberality is given by the <code>ideo</code> column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df0 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(ideo) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Ideology&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Respondents&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Responses by ideology&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;There are {df0 %&gt;% distinct(ideo) %&gt;% nrow()} ideologies in the dataset&#39;</span>),
    <span class="dt">caption =</span> <span class="st">&#39;Source: http://www.people-press.org/2008/11/02/november-2008-election-weekend-survey/&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/ideo_count-1..svg" />
</figure>
<h3 id="obama-voters">Obama voters</h3>
<p>The data indicating vote is not so obvious. There is</p>
<ul>
<li>current voting preference in question 3, of which there are different versions for different states;</li>
<li>there are various columns derived from the survey responses to question 3, such as <code>q3horse</code>;</li>
<li>there is question 6 which asks for voting intention in November; and</li>
<li>there is a column called <code>obama</code> for which I couldn’t find any documentation.</li>
</ul>
<p>Despite the lack of documentation, I’ll run with <code>obama</code> since the responses seem to align better with the purpose of the exercise.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df0 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(obama) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Vote&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Respondents&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Responses by vote&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;There are {df0 %&gt;% distinct(obama) %&gt;% nrow()} voting intentions in the dataset&#39;</span>),
    <span class="dt">caption =</span> <span class="st">&#39;Source data: http://www.people-press.org/2008/11/02/november-2008-election-weekend-survey/&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/vote_count-1..svg" />
</figure>
<h3 id="data-augmentation">Data augmentation</h3>
<p>In order to display two-letter abbreviations of the states, we use the data provided by the <code>state</code> package and join it to the Pew dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mapping &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">name =</span> <span class="kw">as_factor</span>(state.name, <span class="dt">levels =</span> <span class="kw">levels</span>(df<span class="op">$</span>sstate)), 
  <span class="dt">abbreviation =</span> state.abb
)

df &lt;-<span class="st"> </span>df0 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(mapping, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;sstate&#39;</span> =<span class="st"> &#39;name&#39;</span>))</code></pre></div>
<p>Here’s a sample from the mapping table.</p>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
abbreviation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Alabama
</td>
<td style="text-align:left;">
AL
</td>
</tr>
<tr>
<td style="text-align:left;">
Alaska
</td>
<td style="text-align:left;">
AK
</td>
</tr>
<tr>
<td style="text-align:left;">
Arizona
</td>
<td style="text-align:left;">
AZ
</td>
</tr>
<tr>
<td style="text-align:left;">
Arkansas
</td>
<td style="text-align:left;">
AR
</td>
</tr>
<tr>
<td style="text-align:left;">
California
</td>
<td style="text-align:left;">
CA
</td>
</tr>
<tr>
<td style="text-align:left;">
Colorado
</td>
<td style="text-align:left;">
CO
</td>
</tr>
</tbody>
</table>
<h2 id="ideology-vs.obama-voter">Ideology vs. Obama voter</h2>
<h3 id="raw-proportions">Raw proportions</h3>
<p>Let’s take a look at how the proportion of liberals relates to the proportion of Obama voters. There seems to be a positive relation, although the data are fairly noisy. Plotting the full range of values on the y-axis makes the noise more prominent. We only show the resticted range in order to show the individual state names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qa &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(sstate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">respondents =</span> <span class="kw">n</span>(),
    <span class="dt">liberals =</span> <span class="kw">sum</span>(ideo <span class="op">==</span><span class="st"> &#39;Very liberal&#39;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">liberal_proportion =</span> liberals <span class="op">/</span><span class="st"> </span>respondents,
    <span class="dt">obama_voters =</span> <span class="kw">sum</span>(obama <span class="op">==</span><span class="st"> &#39;Obama voter&#39;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">obama_vote_share =</span> obama_voters <span class="op">/</span><span class="st"> </span>respondents  
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(mapping, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;sstate&#39;</span> =<span class="st"> &#39;name&#39;</span>))

qa <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">y =</span> liberal_proportion, <span class="dt">x =</span> obama_vote_share) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> abbreviation, <span class="dt">alpha =</span> <span class="kw">log</span>(respondents)), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">hjust =</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">y =</span> <span class="st">&#39;Observed proportion of liberals&#39;</span>,
    <span class="dt">x =</span> <span class="st">&#39;Obama vote share&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Obama vote share vs liberal proportion for each state&#39;</span>,
    <span class="dt">subtitle =</span> <span class="st">&#39;The y-axis is truncated so that the labels are readable&#39;</span>,
    <span class="dt">caption =</span> <span class="st">&#39;Source data: http://www.people-press.org/2008/11/02/november-2008-election-weekend-survey/&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/state_liberal_vs_obama-1..svg" />
</figure>
<h3 id="posterior-inference">Posterior inference</h3>
<p>We’ll base our prior on the data (for convenience) and don’t take survey non-response issues into account. The pooled mean proportion of liberals will be our prior mean.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu &lt;-<span class="st"> </span><span class="kw">sum</span>(df<span class="op">$</span>ideo <span class="op">==</span><span class="st"> &#39;Very liberal&#39;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(df)
<span class="kw">percent</span>(mu)</code></pre></div>
<pre><code>[1] &quot;3.5%&quot;</code></pre>
<p>After trying various possibilities for the standard deviation <code>sigma</code>, the value below results in a prior that puts most of the density between 0% and 18%.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sigma &lt;-<span class="st"> </span><span class="fl">0.04</span>

shape &lt;-<span class="st"> </span>(mu <span class="op">/</span><span class="st"> </span>sigma)<span class="op">^</span><span class="dv">2</span>
rate &lt;-<span class="st"> </span>shape <span class="op">/</span><span class="st"> </span>mu

<span class="kw">tibble</span>(
    <span class="dt">prop =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.0005</span>),
    <span class="dt">density =</span> <span class="kw">dgamma</span>(prop, shape, rate)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(prop, density) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;white&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.3</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Proportion of liberals&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Density&#39;</span>,
    <span class="dt">title =</span> <span class="kw">str_glue</span>(<span class="kw">paste</span>(
      <span class="st">&#39;Gamma(shape = {signif(shape, digits = 2)}, rate = {signif(rate, digits = 2)})&#39;</span>,
      <span class="dt">sep =</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>
    ))
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/prior-1..svg" />
</figure>
<p>Let’s add the posterior means to our dataset and plot the them against proportion of Obama voters. In order to be visually comparable to the plot of observed data, we keep the limits of the axes the same.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qa_posterior &lt;-<span class="st"> </span>qa <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">posterior_shape =</span> shape <span class="op">+</span><span class="st"> </span>liberals,
    <span class="dt">posterior_rate =</span> rate <span class="op">+</span><span class="st"> </span>respondents,
    <span class="dt">posterior_mean =</span> posterior_shape <span class="op">/</span><span class="st"> </span>posterior_rate
  )

qa_posterior <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">y =</span> posterior_mean, <span class="dt">x =</span> obama_vote_share) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> abbreviation, <span class="dt">alpha =</span> <span class="kw">log</span>(respondents)), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">hjust =</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">y =</span> <span class="st">&#39;Posterior mean of proportion of liberals&#39;</span>,
    <span class="dt">x =</span> <span class="st">&#39;Obama vote share&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Obama vote share vs estimate of liberal proportion&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/posterior-1..svg" />
</figure>
<p>The posterior 95% credible intervals are shown below. Arizona and Louisianna seem to have a smaller proportional of liberals compared to the country average. Only Oregon’s credible interval is entirely above the country average.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qa_posterior <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">ci =</span> <span class="kw">map2</span>(
      posterior_shape, 
      posterior_rate, 
      <span class="cf">function</span>(s, r) 
        <span class="kw">tibble</span>(
          <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&#39;lower&#39;</span>, <span class="st">&#39;upper&#39;</span>),
          <span class="dt">value =</span> <span class="kw">qgamma</span>(<span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), s, r)
        ) 
    )
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(ci) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(type, value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> mu, <span class="dt">linetype =</span> <span class="st">&#39;dotted&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;orange&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="kw">reorder</span>(sstate, posterior_mean), posterior_mean) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">fatten =</span> <span class="fl">0.1</span>, <span class="dt">size =</span> <span class="fl">0.4</span>)  <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">y =</span> <span class="st">&#39;Posterior value&#39;</span>,
    <span class="dt">x =</span> <span class="st">&#39;State&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;95% credible intervals for the proportion of liberals per state&#39;</span>,
    <span class="dt">subtitle =</span> <span class="st">&#39;The pooled observed mean value is shown in orange&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/ci-1..svg" />
</figure>
<p>All of the states in which no liberals were observed had smaller sample sizes (below 50). The largest proportions were also observed in the states with sample sizes below 50. This plot looks fairly similar to the analogous plot for the cancer rate example, albeit with fewer data points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qa <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(respondents, liberal_proportion) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> abbreviation, <span class="dt">alpha =</span> <span class="kw">log</span>(respondents)), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">hjust =</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Number of respondents&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Observed proportion of liberals&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Observed proportion of liberals per state&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/observed_prop_vs_num_respondents-1..svg" />
</figure>
<p>The posterior estimates result in much less extreme values for the states with few respondents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qa_posterior <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(respondents, posterior_mean) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> abbreviation, <span class="dt">alpha =</span> <span class="kw">log</span>(respondents)), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">hjust =</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Number of respondents&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Posterior mean of proportion of liberals&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Posterior proportion of liberals by state&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/posterior_prop_vs_num_respondents-1..svg" />
</figure>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 20</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_20.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_20.html</id>
    <published>2018-09-08T00:00:00Z</published>
    <updated>2018-09-08T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 20</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  8, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/exponential.html">exponential</a>, <a href="/tags/gamma.html">gamma</a>, <a href="/tags/truncated%0Aobservations.html">truncated
observations</a>, <a href="/tags/posterior%20variance.html">posterior variance</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 20, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial} \DeclareMathOperator{\dbern}{Bernoulli} \DeclareMathOperator{\dpois}{Poisson} \DeclareMathOperator{\dnorm}{Normal} \DeclareMathOperator{\dcauchy}{Cauchy} \DeclareMathOperator{\dexponential}{Exp} \DeclareMathOperator{\dgamma}{Gamma} \DeclareMathOperator{\dinvgamma}{InvGamma} \DeclareMathOperator{\invlogit}{InvLogit} \DeclareMathOperator{\logit}{Logit} \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Suppose <span class="math inline">\(y \mid \theta \sim \dexponential(\theta)\)</span> with prior <span class="math inline">\(\theta \sim \dgamma(\alpha, \beta)\)</span>. If we observe that <span class="math inline">\(y \ge 100\)</span>, then the posterior is</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\theta \mid y \ge 100)
  &amp;\propto
  \theta^{\alpha - 1} e^{-\beta \theta}
  \int_{y = 100}^\infty \theta e^{-\theta y} dy
  \\
  &amp;=
  \theta^{\alpha - 1} e^{-\beta \theta}
  \left[ (-1) e^{-\theta y}  \right]_{100}^\infty
  \\
  &amp;=
  \theta^{\alpha - 1} e^{-\beta \theta}
  e^{-100\theta}
  \\
  &amp;=
  \theta^{\alpha - 1} e^{-(\beta + 100) \theta}
  ,
\end{align}
\]</span></p>
<p>which is a <span class="math inline">\(\dgamma(\alpha, \beta + 100)\)</span> distribution. The posterior mean is <span class="math inline">\(\frac{\alpha}{\beta + 100}\)</span> and the posterior variance is <span class="math inline">\(\frac{\alpha}{(\beta + 100)^2}\)</span>.</p>
<p>If instead we had observed <span class="math inline">\(y = 100\)</span>, the posterior would have been</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\theta \mid y = 100)
  &amp;\propto
  \theta^{\alpha - 1} e^{-\beta \theta}
  \theta e^{-\theta 100} 
  \\
  &amp;=
  \theta^{\alpha} e^{-(\beta + 100) \theta}
  ,
\end{align}
\]</span></p>
<p>which is a <span class="math inline">\(\dgamma(\alpha + 1, \beta + 100)\)</span> distribution. The posterior mean here is <span class="math inline">\(\frac{\alpha + 1}{\beta + 100}\)</span> and the posterior variance is <span class="math inline">\(\frac{\alpha + 1}{(\beta + 100)^2}\)</span>.</p>
<p>Both of these estimates are greater than in the case of observing <span class="math inline">\(y \ge 100\)</span>. This is surprising because knowing that <span class="math inline">\(y = 100\)</span> is more informative than just knowing <span class="math inline">\(y \ge 100\)</span>. The reason there is actually less variance when <span class="math inline">\(y \ge 100\)</span> is that we get to average over all possibilities of <span class="math inline">\(y \ge 100\)</span>, and the case <span class="math inline">\(y = 100\)</span> has the greatest variance of all these possibilities.</p>
<p>We can illustrate this idea more formally using identity (2.8). In the context of this exercise, the identity can be written</p>
<p class="mathjaxWide"><span class="math display">\[
\mathbb V \left(\theta \mid y \ge 100 \right)
\ge
\mathbb E \left( \mathbb V \left(\theta \mid y \right) \mid y \ge 100 \right)
,
\]</span></p>
<p>where all the probabilities are now conditional on <span class="math inline">\(y \ge 100\)</span>. The left hand side is the posterior variance given <span class="math inline">\(y \ge 100\)</span>, which we calculated above to be <span class="math inline">\(\frac{\alpha}{(\beta + 100)^2}\)</span>. The quantity <span class="math inline">\(\mathbb E ( \mathbb V (\theta \mid y = 100) \mid y \ge 100)\)</span> is just <span class="math inline">\(\frac{\alpha + 1}{(\beta + 100)^2}\)</span> as shown above, which is greater than the LHS. However, this quantity is fundamentally different to what the right hand side of the identity expresses. The RHS actually evaluates to</p>
<p class="mathjaxWide"><span class="math display">\[
\int_{100}^\infty \frac{\alpha}{(\beta + \tilde y)^2} p(\tilde y \mid y \ge 100) d\tilde y.
\]</span></p>
<p>That is, it averages over all possible realisations of the variance given <span class="math inline">\(y \ge 100\)</span>. The inequality only guarantees that the posterior variance is <em>on average</em> smaller than the prior variance, so we can’t just plug in one value of interest.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 19</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_19.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_19.html</id>
    <published>2018-09-08T00:00:00Z</published>
    <updated>2018-09-08T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 19</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  8, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/gamma.html">gamma</a>, <a href="/tags/exponential.html">exponential</a>, <a href="/tags/conjugate%20prior.html">conjugate prior</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 19, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial}  \DeclareMathOperator{\dbern}{Bernoulli}  \DeclareMathOperator{\dpois}{Poisson}  \DeclareMathOperator{\dnorm}{Normal}  \DeclareMathOperator{\dcauchy}{Cauchy}  \DeclareMathOperator{\dexponential}{Exp}  \DeclareMathOperator{\dgamma}{Gamma}  \DeclareMathOperator{\dinvgamma}{InvGamma}  \DeclareMathOperator{\invlogit}{InvLogit}  \DeclareMathOperator{\logit}{Logit}  \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Let’s show that the gamma distribution is conjugate to the exponential distribution. That is, we suppose <span class="math inline">\(y \mid \theta \sim \dexponential(\theta)\)</span> with prior <span class="math inline">\(\theta \sim \dgamma(\alpha, \beta)\)</span>, and show that the posterior is also gamma distributed.</p>
<p>The posterior is</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\theta \mid y)
  &amp;\propto
  \theta^n e^{-\theta \sum_1^n y_i} \cdot \theta^{\alpha - 1} e^{-\beta \theta}
  \\
  &amp;=
  \theta^{n + \alpha - 1} e^{-\theta \left(\beta + \sum_1^n y_i \right)}
\end{align}
\]</span></p>
<p>which implies <span class="math inline">\(\theta \mid y \sim \dgamma(\alpha + n, \beta + \sum_1^n y_i)\)</span>.</p>
<p>Suppose now that we wish to do inference on <span class="math inline">\(\phi := \theta^{-1}\)</span>. We will show that <span class="math inline">\(\phi\)</span> has an inverse gamma distribution if <span class="math inline">\(\theta\)</span> has a gamma distribution. Indeed,</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\phi)
  &amp;\propto
  p(\theta) \left\vert {\frac{d\phi}{d\theta}} \right\vert^{-1}
  \\
  &amp;=
  \theta^{\alpha - 1} e^{-\beta \theta} \cdot\theta^2
  \\
  &amp;=
  \phi^{-\alpha - 1} e^{-\frac{\beta}{\phi}}
  ,
\end{align}
\]</span></p>
<p>which corresponds to an <span class="math inline">\(\dinvgamma(\alpha, \beta)\)</span> distribution.</p>
<p>Suppose that the lifetime of a light bulb can be modelled as an exponential distribution with rate <span class="math inline">\(\theta\)</span>. Let’s compare inferences using the two different parameterisations above. For <span class="math inline">\(\theta \sim \dgamma(\alpha, \beta)\)</span>, the prior variance is <span class="math inline">\(\frac{\alpha}{\beta^2}\)</span> and the mean is <span class="math inline">\(\frac{\alpha}{\beta}\)</span>, so the prior coefficient of variation is <span class="math inline">\(\alpha^{-\frac{1}{2}}\)</span>. We are given that the prior coefficient of variation is 0.5, so <span class="math inline">\(\alpha = 4\)</span>. The posterior coefficient of variation is <span class="math inline">\((4 + n)^{-\frac{1}{2}}\)</span>. If we wish this to be at most 0.1, then we would need to test at least <span class="math inline">\(n = 96\)</span> light bulbs.</p>
<p>For <span class="math inline">\(\phi \sim \dinvgamma(\alpha, \beta)\)</span>, the prior variance is</p>
<p class="mathjaxWide"><span class="math display">\[
\frac{\beta^2}{(\alpha - 1)^2 (\alpha - 2)}
\]</span></p>
<p>and the mean is <span class="math inline">\(\frac{\beta}{\alpha - 1}\)</span>, so the prior coefficient of variation is <span class="math inline">\((\alpha - 2)^{-\frac{1}{2}}\)</span>. With a prior coefficient of variation is 0.5, we have <span class="math inline">\(\alpha = 6\)</span>. The posterior coefficient of variation is <span class="math inline">\((6 + n)^{-\frac{1}{2}}\)</span>. If we wish this to be at most 0.1, then we would need to test at least <span class="math inline">\(n = 94\)</span> light bulbs.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 18</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_18.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_18.html</id>
    <published>2018-09-08T00:00:00Z</published>
    <updated>2018-09-08T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 18</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  8, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/gamma.html">gamma</a>, <a href="/tags/poisson.html">poisson</a>, <a href="/tags/conjugate%20prior.html">conjugate prior</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 18, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{binomial}  \DeclareMathOperator{\dbern}{Bernoulli}  \DeclareMathOperator{\dpois}{Poisson}  \DeclareMathOperator{\dnorm}{normal}  \DeclareMathOperator{\dcauchy}{Cauchy}  \DeclareMathOperator{\dgamma}{gamma}  \DeclareMathOperator{\invlogit}{invlogit}  \DeclareMathOperator{\logit}{logit}  \DeclareMathOperator{\dbeta}{beta}\)</span></p>
</div>
<p>Suppose we have <span class="math inline">\(n\)</span> observations from a Poisson likelihood, <span class="math inline">\(y_i \mid \theta \sim \dpois(x_i\theta)\)</span>, with rate <span class="math inline">\(\theta\)</span> and exposure <span class="math inline">\(x_i\)</span>. We show that with a gamma prior, <span class="math inline">\(\theta \sim \dgamma(\alpha, \beta)\)</span>, the posterior also has a gamma distribution.</p>
<p>As shown in the book, the likelihood and prior are</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
p (y \mid \theta)
&amp;\propto
\theta^{\sum_1^n y_i} e^{-\theta \sum_i^n x_i}
\\
p(\theta)
&amp;\propto
\theta^{\alpha - 1} e^{-\beta \theta}
.
\end{align}
\]</span></p>
<p>Thus the posterior is</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
p (\theta \mid y)
&amp;\propto
\theta^{\sum_1^n y_i} e^{-\theta \sum_i^n x_i}
\cdot
\theta^{\alpha - 1} e^{-\beta \theta}
\\
&amp;=
\theta^{\alpha - 1 + \sum_1^n y_i}
e^{-\theta \left( \beta + \sum_1^n x_i \right)}
,
\end{align}
\]</span></p>
<p>which shows that <span class="math inline">\(p(\theta \mid y) \sim \dgamma(\alpha + \sum_1^n y_i, \beta + \sum_1^n x_i)\)</span>.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>

</feed>
