<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>Thoughts from the Café</title>
    <link href="http://stappit.github.io/atom.xml" rel="self" />
    <link href="http://stappit.github.io" />
    <id>http://stappit.github.io/atom.xml</id>
    <author>
        <name>Brian</name>
        <email>ha@hahaha.com</email>
    </author>
    <updated>2018-09-14T00:00:00Z</updated>
    <entry>
    <title>BDA3 Chapter 3 Exercise 1</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_03_exercise_01.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_03_exercise_01.html</id>
    <published>2018-09-14T00:00:00Z</published>
    <updated>2018-09-14T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 3 Exercise 1</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September 14, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%203.html">bda chapter 3</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/multinomial.html">multinomial</a>, <a href="/tags/dirichlet.html">dirichlet</a>, <a href="/tags/change%20of%20variables.html">change of variables</a>, <a href="/tags/beta.html">beta</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 1, chapter 3, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial}  \DeclareMathOperator{\dmultinomial}{Multinomial}  \DeclareMathOperator{\dbern}{Bernoulli}  \DeclareMathOperator{\dpois}{Poisson}  \DeclareMathOperator{\dnorm}{Normal}  \DeclareMathOperator{\dcauchy}{Cauchy}  \DeclareMathOperator{\dexponential}{Exp}  \DeclareMathOperator{\ddirichlet}{Dirichlet}  \DeclareMathOperator{\dgamma}{Gamma}  \DeclareMathOperator{\dinvgamma}{InvGamma}  \DeclareMathOperator{\invlogit}{InvLogit}  \DeclareMathOperator{\logit}{Logit}  \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Let <span class="math inline">\(y \mid \theta \sim \dmultinomial_J(\theta)\)</span> with prior <span class="math inline">\(\theta \sim \ddirichlet_J(\alpha)\)</span>. We would like to find the marginal distribution of <span class="math inline">\(\phi := \frac{\theta_1}{\theta_1 + \theta_2}\)</span>.</p>
<h2 id="marginal-posterior-of-dirichlet-multinomial">Marginal posterior of Dirichlet-multinomial</h2>
<p>As shown in the book, the posterior is <span class="math inline">\(\theta \mid y \sim \ddirichlet(y + \alpha)\)</span>. The marginal posterior of <span class="math inline">\((\theta_1, \theta_2) \mid y\)</span> can be written as</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\theta_1, \theta_2 \mid y)
  &amp;=
  \int_0^1 p(\theta \mid y) d\theta_3 \dotsm d\theta_{J - 1}
  \\
  &amp;\propto
  \theta_1^{y_1 + \alpha_1 - 1}\theta_2^{y_2 + \alpha_2 - 1}
  \int_0^1 \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 1}^{y_{J - 1} + \alpha_{J - 1} - 1} 
  \left(1 - \sum_1^{J - 1} \theta_j \right)^{y_J + \alpha_J - 1} d\theta_3 \dotsm d\theta_{J - 1}
  .
\end{align}
\]</span></p>
<p>The tricky part is calculating the integral part, which we define</p>
<p class="mathjaxWide"><span class="math display">\[
I 
:=
\int_0^1 \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 1}^{y_{J - 1} + \alpha_{J - 1} - 1} 
\left(1 - \sum_1^{J - 1} \theta_j \right)^{y_J + \alpha_J - 1} d\theta_3 \dotsm d\theta_{J - 1}
.
\]</span></p>
<p>To calculate <span class="math inline">\(I\)</span>, first note that</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  \int_0^1 \theta^s \left( c - \theta \right)^t d\theta 
  &amp;=
  \int_0^1 \theta^s \left( 1 - \frac{\theta}{c} \right)^t c^t d\theta 
  \\
  &amp;=
  \int_0^1 \left( \frac{\theta}{c} \right)^s \left( 1 - \frac{\theta}{c} \right)^t c^{s + t} d\theta 
  \\
  &amp;=
  \int_0^1 \phi^s \left( 1 - \phi \right)^t c^{s + t + 1} d\phi
  ,
  \quad 
  \phi := \frac{\theta}{c}
  \\
  &amp;=
  B(s + 1, t + 1) c^{s + t + 1} 
  ,
\end{align}
\]</span></p>
<p>if <span class="math inline">\(c\)</span> is not a function of <span class="math inline">\(\theta\)</span>. With <span class="math inline">\(c := 1 - \sum_1^{J - 2} \theta_j\)</span>,</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  I
  &amp;=
  \int_0^1 
  \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 2}^{y_{J - 2} + \alpha_{J - 2} - 1} 
  \theta_{J - 1}^{y_{J - 1} + \alpha_{J - 1} - 1} 
  \left(
    1 - \sum_1^{J - 2} \theta_j - \theta_{J - 1} 
  \right)^{y_J + \alpha_J - 1} 
  d\theta_3 \dotsm d\theta_{J - 1}
  \\
  &amp;=
  \int_0^1 
  \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 2}^{y_{J - 2} + \alpha_{J - 2} - 1}
  \left(
  \int_0^1 
    \theta_{J - 1}^{y_{J - 1} + \alpha_{J - 1} - 1} 
    \left(c - \theta_{J - 1} \right)^{y_J + \alpha_J - 1} 
  d\theta_{J - 1} \right) d\theta_3 \dotsm d\theta_{J - 2}
  \\
  &amp;\propto
  \int_0^1 
  \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 2}^{y_{J - 2} + \alpha_{J - 2} - 1}
  \left( c \right)^{y_{J-1} + y_J + \alpha_{J-1} + \alpha_J - 1}
  d\theta_3 \dotsm d\theta_{J - 2}
  \\
  &amp;=
  \int_0^1 
  \theta_3^{y_3 + \alpha_3 - 1} \dotsm \theta_{J - 2}^{y_{J - 2} + \alpha_{J - 2} - 1}
  \left( 1 - \sum_1^{J-2} \theta_j \right)^{y_{J-1} + y_J + \alpha_{J-1} + \alpha_J - 1}
  d\theta_3 \dotsm d\theta_{J - 2}
  .
\end{align}
\]</span></p>
<p>Continuing by induction,</p>
<p class="mathjaxWide"><span class="math display">\[
I
=
\left(
  1 - \theta_1 - \theta_2
\right) ^ {\sum_3^J (y_j + \alpha_j) - 1}
.
\]</span></p>
<p>Now that we have the integral part, the marginal posterior can be written</p>
<p class="mathjaxWide"><span class="math display">\[
p(\theta_1, \theta_2 \mid y)
\propto
\theta_1^{y_1 + \alpha_1 - 1}\theta_2^{y_2 + \alpha_2 - 1}
\left(
  1 - \theta_1 - \theta_2
\right) ^ {\sum_3^J (y_j + \alpha_j) - 1}
.
\]</span></p>
<p>This has the form of a Dirichlet distribution, so the marginal posterior is</p>
<p class="mathjaxWide"><span class="math display">\[
\left( \theta_1, \theta_2, 1 - \theta_1 - \theta_2 \right) \mid y
\sim
\ddirichlet\left(y_1 + \alpha_1, y_2 + \alpha_2, \sum_3^J (y_j + \alpha_j) \right)
.
\]</span></p>
<h2 id="change-of-variables">Change of variables</h2>
<p>Now define <span class="math inline">\((\phi_1, \phi_2) := (\frac{\theta_1}{\theta_1 + \theta_2}, \theta_1 + \theta_2)\)</span>, so that $(_1, _2) = (_1_2, _2 - _12). The Jacobian of this transformation is</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{bmatrix}
  \frac{\partial\theta_1}{\partial\phi_1} &amp; \frac{\partial\theta_1}{\partial\phi_2} \\
  \frac{\partial\theta_2}{\partial\phi_1} &amp; \frac{\partial\theta_2}{\partial\phi_2} 
\end{bmatrix}
=
\begin{bmatrix}
  \phi_2 &amp; \phi_1 \\
  -\phi_2 &amp; 1 - \phi_1
\end{bmatrix}
=
\phi_2
.
\]</span></p>
<p>Therefore, the probability distribution of the new variables is</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\phi_1, \phi_2 \mid y)
  &amp;=
  (\phi_1\phi_2)^{y_1 + \alpha_1 - 1} (\phi_2 (1 - \phi_1))^{y_2 + \alpha_2 - 1} (1 - \phi_2)^{\sum_3^J (y_j + \alpha_j) - 1} \frac{1}{\phi_2}
  \\
  &amp;=
  \phi_1^{y_1 + \alpha_1 - 1} (1 - \phi_1)^{y_2 + \alpha_2 - 1}
  \phi_2^{y_1 + y_2 + \alpha_1 + \alpha_2 - 3} (1 - \phi_2)^{\sum_3^J (y_j + \alpha_j) - 1}
  \\
  &amp;=
  p(\phi_1 \mid y) p(\phi_2 \mid y)
  ,
\end{align}
\]</span></p>
<p>where</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
\phi_1 \mid y &amp;\sim \dbeta(y_1 + \alpha_1, y_2 + \alpha_2 )
\\
\phi_2 \mid y &amp;\sim \dbeta\left(y_1 + y_2 + \alpha_1 + \alpha_2 - 2, \sum_3^J (y_j + \alpha_j)\right)
.
\end{align}
\]</span></p>
<p>The marginal posterior for <span class="math inline">\(\phi_1\)</span> is equivalent to the posterior obtained from a <span class="math inline">\(\phi_1 \sim \dbeta(\alpha_1, \alpha_2)\)</span> prior with a <span class="math inline">\(y_1 \mid \phi_1 \sim \dbinomial(y_1 + y_2, \phi_1)\)</span> likelihood.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>Cox Proportional Hazard</title>
    <link href="http://stappit.github.io/posts/survival_models/cox_models.html" />
    <id>http://stappit.github.io/posts/survival_models/cox_models.html</id>
    <published>2018-09-10T00:00:00Z</published>
    <updated>2018-09-10T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">Cox Proportional Hazard</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September 10, 2018  by Brian </br>
     Tags:  </br>
     Category: <a href="/categories/survival_models.html">survival_models</a> 
    </p>
  </div>
</div>

<p><a href="./hazard.html">Last time</a> we saw that the hazard function can be modelled directly from <a href="./censoring.html">right-censored time-to-event observations</a> using a Poisson likelihood. In this post, we’ll use those ideas to fit a constant hazard to data using Poisson regression, then exend those ideas to fitting arbitrary hazard functions (again with Poisson regression). This latter model is often called a Cox proportional hazards model. We’ll finish by comparing our Cox model with that provided by the <a href="https://cran.r-project.org/web/packages/survival/index.html">survival package</a>.</p>
<!--more-->
<h2 id="constant-hazard">Constant hazard</h2>
<p>Time-to-event observations have constant hazard when those observations have an exponential distribution. We’ll generate observations from an exponential distribution with mean 5 and with censoring occurring independently of these observations. The hazard should be equal to the reciprocal of the mean, <span class="math inline">\(h = 1 / 5 = 0.2\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="dv">1000</span>
mu &lt;-<span class="st"> </span><span class="dv">5</span>

dfc &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span>N,
  <span class="dt">tte =</span> <span class="kw">rexp</span>(N, <span class="dv">1</span> <span class="op">/</span><span class="st"> </span>mu),
  <span class="dt">tto =</span> <span class="kw">pmin</span>(<span class="kw">rpois</span>(N, <span class="dv">6</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, tte),
  <span class="dt">censored =</span> tto <span class="op">&lt;</span><span class="st"> </span>tte
)</code></pre></div>
<table class="table table-hover table-striped table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
tte
</th>
<th style="text-align:right;">
tto
</th>
<th style="text-align:left;">
censored
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10.2071355
</td>
<td style="text-align:right;">
5.0000000
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0476003
</td>
<td style="text-align:right;">
0.0476003
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
8.9127093
</td>
<td style="text-align:right;">
6.0000000
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1.0817773
</td>
<td style="text-align:right;">
1.0817773
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
20.5001714
</td>
<td style="text-align:right;">
10.0000000
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
6.0146226
</td>
<td style="text-align:right;">
4.0000000
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
</table>
<p>The <a href="./hazard.html">hazard</a> can be estimated by Poisson regression of the deaths (= -<code>censored</code>) against the exposure time (<code>tto</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfc <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">glm</span>(
    <span class="dt">formula =</span> <span class="op">!</span>censored <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">offset</span>(<span class="kw">log</span>(tto)),
    <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link =</span> <span class="st">&#39;log&#39;</span>),
    <span class="dt">data =</span> .
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>(estimate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">exp</span>() <span class="co"># inverse of the log-link</span></code></pre></div>
<pre><code>[1] 0.1967661</code></pre>
<p>As expected, it’s around 0.2.</p>
<h2 id="cox-model">Cox model</h2>
<p>Instead of assuming that our observations are drawn from a specified distribution, we can try to model arbitrary distributions. We do this by breaking up our observations into intervals and modelling the average hazard as a constant in each interval using the method outlined above.</p>
<h3 id="the-unknown-distribution">The unknown distribution</h3>
<p>Let’s use the Weibull distributions as the ‘unknown’ distribution from which our times-to-event are drawn.</p>
<figure>
<img src="cox_models_files/figure-markdown/weibull-1..svg" />
</figure>
<p>The corresponding hazard function is shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(
    <span class="dt">x =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="fl">0.1</span>),
    <span class="dt">h =</span> (shape <span class="op">/</span><span class="st"> </span>scale) <span class="op">*</span><span class="st"> </span>(x <span class="op">/</span><span class="st"> </span>scale)<span class="op">^</span>(shape <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(x, h) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">y =</span> <span class="st">&#39;Hazard&#39;</span>,
    <span class="dt">title =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Weibull(scale = {scale}, shape = {shape}) hazard function&#39;</span>)
  )</code></pre></div>
<figure>
<img src="cox_models_files/figure-markdown/unnamed-chunk-1-1..svg" />
</figure>
<h3 id="fitting-the-parameters">Fitting the parameters</h3>
<p>Let’s generate data where the <code>tte</code> is generated from the Weibull distribution above, but where the observations <code>tto</code> are censored.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="dv">1000</span>
mu &lt;-<span class="st"> </span><span class="dv">5</span>

dfa &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span>N,
  <span class="dt">tte =</span> <span class="kw">rweibull</span>(N, shape, scale),
  <span class="dt">tto =</span> <span class="kw">pmin</span>(<span class="kw">rpois</span>(N, <span class="dv">5</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, tte),
  <span class="dt">censored =</span> tto <span class="op">&lt;</span><span class="st"> </span>tte
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfa <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&#39;hover&#39;</span>, <span class="st">&#39;striped&#39;</span>, <span class="st">&#39;responsive&#39;</span>))</code></pre></div>
<table class="table table-hover table-striped table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
tte
</th>
<th style="text-align:right;">
tto
</th>
<th style="text-align:left;">
censored
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.487325
</td>
<td style="text-align:right;">
1.487325
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.360646
</td>
<td style="text-align:right;">
1.360646
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.511586
</td>
<td style="text-align:right;">
1.511586
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1.052489
</td>
<td style="text-align:right;">
1.052489
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1.317465
</td>
<td style="text-align:right;">
1.317465
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1.745921
</td>
<td style="text-align:right;">
1.745921
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
</tbody>
</table>
<h2 id="comparison-with-survival">Comparison with <code>survival</code></h2>
<h3 id="data">Data</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;mastectomy&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;HSAUR&quot;</span>)

df &lt;-<span class="st"> </span>mastectomy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(time) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">transmute</span>(
    <span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(),
    <span class="dt">months =</span> time,
    event,
    <span class="dt">metastized =</span> metastized <span class="op">==</span><span class="st"> &#39;yes&#39;</span>
  ) </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&#39;hover&#39;</span>, <span class="st">&#39;striped&#39;</span>, <span class="st">&#39;responsive&#39;</span>))</code></pre></div>
<table class="table table-hover table-striped table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
months
</th>
<th style="text-align:left;">
event
</th>
<th style="text-align:left;">
metastized
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> event, <span class="dt">y =</span> ..count.. <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(..count..))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&#39;stack&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Event observed?&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Fraction of rows&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Censoring in the masectomy dataset&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Total rows: {df %&gt;% nrow()}&#39;</span>)
  )</code></pre></div>
<figure>
<img src="cox_models_files/figure-markdown/unnamed-chunk-3-1..svg" />
</figure>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> months, <span class="dt">x =</span> <span class="kw">reorder</span>(id, months), <span class="dt">fill =</span> metastized, <span class="dt">width =</span> <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">alpha =</span> event)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">y =</span> <span class="st">&#39;Months&#39;</span>,
    <span class="dt">x =</span> <span class="st">&#39;Person&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;&#39;</span>,
    <span class="dt">fill =</span> <span class="st">&#39;Metastised?&#39;</span>,
    <span class="dt">alpha =</span> <span class="st">&#39;Event?&#39;</span>
  ) </code></pre></div>
<figure>
<img src="cox_models_files/figure-markdown/metastized_censoring-1..svg" />
</figure>
<h3 id="piecewise-constant-hazard">Piecewise-constant hazard</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">M &lt;-<span class="st"> </span><span class="dv">3</span> <span class="co"># size of intervals</span>

df1 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="co"># all combos of person and interval</span>
<span class="st">  </span><span class="kw">expand.grid</span>(
    <span class="dt">id =</span> df<span class="op">$</span>id,                           <span class="co"># person</span>
    <span class="dt">lower =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">max</span>(df<span class="op">$</span>months) <span class="op">+</span><span class="st"> </span>M, M) <span class="co"># interval lower bound</span>
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># add strict upper bound for the interval</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">upper =</span> lower <span class="op">+</span><span class="st"> </span>M) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># add data for each person</span>
<span class="st">  </span><span class="kw">inner_join</span>(df, <span class="dt">by =</span> <span class="st">&#39;id&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># exclude people that died in a previous interval</span>
<span class="st">  </span><span class="co"># if months lies on the lower bound, assign death to previous interval</span>
<span class="st">  </span><span class="kw">filter</span>(lower <span class="op">&lt;</span><span class="st"> </span>months) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># add death and exposure info</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">death =</span> <span class="kw">if_else</span>(event <span class="op">&amp;</span><span class="st"> </span>months <span class="op">&lt;=</span><span class="st"> </span>upper, <span class="dv">1</span>, <span class="dv">0</span>),
    <span class="dt">exposure =</span> <span class="kw">pmin</span>(months <span class="op">-</span><span class="st"> </span>lower, M)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(id, lower)</code></pre></div>
<p>Let’s take a look at some entries to see what this looks like. We should see</p>
<ul>
<li>a row for every interval in which the person was part of the experiment</li>
<li>the sum of the exposures is equal to <code>months</code></li>
<li><code>death</code> is 1 for the last interval if there was no censoring, or 0 otherwise</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&#39;hover&#39;</span>, <span class="st">&#39;striped&#39;</span>, <span class="st">&#39;responsive&#39;</span>))</code></pre></div>
<table class="table table-hover table-striped table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
<th style="text-align:right;">
months
</th>
<th style="text-align:left;">
event
</th>
<th style="text-align:left;">
metastized
</th>
<th style="text-align:right;">
death
</th>
<th style="text-align:right;">
exposure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table>
<p>In the case that the event occurred on the lower boundary of an interval, we assign the event to the previous interval. This is why we see a death in interval [15, 18) with exposure 3, rather than in interval [18, 21) with exposure 0. We do this because exposure 0 doesn’t make much sense.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&#39;hover&#39;</span>, <span class="st">&#39;striped&#39;</span>, <span class="st">&#39;responsive&#39;</span>))</code></pre></div>
<table class="table table-hover table-striped table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
<th style="text-align:right;">
months
</th>
<th style="text-align:left;">
event
</th>
<th style="text-align:left;">
metastized
</th>
<th style="text-align:right;">
death
</th>
<th style="text-align:right;">
exposure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>For censored cases, <code>death</code> is always 0.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span><span class="dv">21</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&#39;hover&#39;</span>, <span class="st">&#39;striped&#39;</span>, <span class="st">&#39;responsive&#39;</span>))</code></pre></div>
<table class="table table-hover table-striped table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
lower
</th>
<th style="text-align:right;">
upper
</th>
<th style="text-align:right;">
months
</th>
<th style="text-align:left;">
event
</th>
<th style="text-align:left;">
metastized
</th>
<th style="text-align:right;">
death
</th>
<th style="text-align:right;">
exposure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
54
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
54
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>We can check these properties for the whole dataset. First, exposure is never zero.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">min</span>(df1<span class="op">$</span>exposure)</code></pre></div>
<pre><code>[1] 1</code></pre>
<p>The sum of the exposures is equal to the time to observation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">correct =</span> <span class="kw">max</span>(months) <span class="op">==</span><span class="st"> </span><span class="kw">sum</span>(exposure)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(correct) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&#39;hover&#39;</span>, <span class="st">&#39;striped&#39;</span>, <span class="st">&#39;responsive&#39;</span>))</code></pre></div>
<table class="table table-hover table-striped table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
correct
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
44
</td>
</tr>
</tbody>
</table>
<p>The sum of all <code>death</code>s is equal to the censoring status.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">correct =</span> <span class="kw">sum</span>(death) <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(<span class="kw">if_else</span>(event, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(correct) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&#39;hover&#39;</span>, <span class="st">&#39;striped&#39;</span>, <span class="st">&#39;responsive&#39;</span>))</code></pre></div>
<table class="table table-hover table-striped table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
correct
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
44
</td>
</tr>
</tbody>
</table>
<h3 id="parameter-fitting">Parameter fitting</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="kw">glm</span>(
  death <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span><span class="kw">ordered</span>(lower) <span class="op">+</span><span class="st"> </span>metastized <span class="op">+</span><span class="st"> </span><span class="kw">offset</span>(<span class="kw">log</span>(exposure)), 
  <span class="dt">data =</span> df1, 
  <span class="dt">family =</span> <span class="kw">poisson</span>()
)

<span class="kw">summary</span>(m)</code></pre></div>
<pre><code>Call:
glm(formula = death ~ 0 + ordered(lower) + metastized + offset(log(exposure)), 
    family = poisson(), data = df1)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-0.58529  -0.24104  -0.00004  -0.00003   2.70076  

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)    
ordered(lower)0     -23.0696  3827.8812  -0.006 0.995191    
ordered(lower)3      -5.5604     1.0893  -5.105 3.31e-07 ***
ordered(lower)6      -5.5329     1.0885  -5.083 3.72e-07 ***
ordered(lower)9      -5.4949     1.0874  -5.053 4.35e-07 ***
ordered(lower)12     -5.4654     1.0865  -5.030 4.90e-07 ***
ordered(lower)15     -5.4554     1.0862  -5.022 5.11e-07 ***
ordered(lower)18    -23.0438  4062.5100  -0.006 0.995474    
ordered(lower)21     -4.7271     0.8243  -5.735 9.77e-09 ***
ordered(lower)24     -4.6642     0.8241  -5.659 1.52e-08 ***
ordered(lower)27    -23.0389  4287.7503  -0.005 0.995713    
ordered(lower)30     -5.2883     1.0838  -4.880 1.06e-06 ***
ordered(lower)33     -5.2642     1.0830  -4.861 1.17e-06 ***
ordered(lower)36    -23.0246  4413.9934  -0.005 0.995838    
ordered(lower)39     -4.5081     0.8175  -5.515 3.49e-08 ***
ordered(lower)42    -23.0083  4552.2343  -0.005 0.995967    
ordered(lower)45     -4.4627     0.8168  -5.464 4.66e-08 ***
ordered(lower)48     -5.0876     1.0802  -4.710 2.48e-06 ***
ordered(lower)51    -23.0065  4789.6935  -0.005 0.996168    
ordered(lower)54    -23.0065  4789.6935  -0.005 0.996168    
ordered(lower)57     -5.0430     1.0786  -4.675 2.93e-06 ***
ordered(lower)60     -4.9802     1.0763  -4.627 3.71e-06 ***
ordered(lower)63    -22.9855  4968.1051  -0.005 0.996309    
ordered(lower)66     -4.2541     0.8097  -5.254 1.49e-07 ***
ordered(lower)69     -4.8576     1.0785  -4.504 6.67e-06 ***
ordered(lower)72    -23.0016  5402.8587  -0.004 0.996603    
ordered(lower)75    -22.9473  5361.9290  -0.004 0.996585    
ordered(lower)78    -22.9883  5528.3332  -0.004 0.996682    
ordered(lower)81    -22.9883  5528.3332  -0.004 0.996682    
ordered(lower)84    -22.9883  5528.3332  -0.004 0.996682    
ordered(lower)87    -22.9883  5528.3332  -0.004 0.996682    
ordered(lower)90    -22.9883  5528.3332  -0.004 0.996682    
ordered(lower)93    -22.9883  5528.3332  -0.004 0.996682    
ordered(lower)96    -22.9883  5528.3332  -0.004 0.996682    
ordered(lower)99    -22.9285  5436.2581  -0.004 0.996635    
ordered(lower)102   -23.0377  5819.3232  -0.004 0.996841    
ordered(lower)105   -22.9997  5971.5698  -0.004 0.996927    
ordered(lower)108   -22.9396  6087.4480  -0.004 0.996993    
ordered(lower)111    -4.4585     1.0759  -4.144 3.41e-05 ***
ordered(lower)114   -22.9429  6534.8358  -0.004 0.997199    
ordered(lower)117    -4.2465     1.0670  -3.980 6.90e-05 ***
ordered(lower)120   -22.9249  7018.7916  -0.003 0.997394    
ordered(lower)123   -22.9249  7018.7916  -0.003 0.997394    
ordered(lower)126   -22.9249  7018.7916  -0.003 0.997394    
ordered(lower)129   -22.9249  7018.7916  -0.003 0.997394    
ordered(lower)132   -22.9249  7018.7916  -0.003 0.997394    
ordered(lower)135   -22.9249  7018.7916  -0.003 0.997394    
ordered(lower)138   -22.9249  7018.7916  -0.003 0.997394    
ordered(lower)141    -4.1766     1.0638  -3.926 8.63e-05 ***
ordered(lower)144   -22.7890  7218.0828  -0.003 0.997481    
ordered(lower)147    -3.9388     1.0579  -3.723 0.000197 ***
ordered(lower)150   -22.8936  8000.1167  -0.003 0.997717    
ordered(lower)153   -22.8936  8000.1167  -0.003 0.997717    
ordered(lower)156   -22.8936  8000.1167  -0.003 0.997717    
ordered(lower)159   -22.8936  8000.1167  -0.003 0.997717    
ordered(lower)162   -22.8472  8431.0823  -0.003 0.997838    
ordered(lower)165   -22.8472  8431.0823  -0.003 0.997838    
ordered(lower)168   -22.8472  8431.0823  -0.003 0.997838    
ordered(lower)171   -22.8472  8431.0823  -0.003 0.997838    
ordered(lower)174   -22.8472  8431.0823  -0.003 0.997838    
ordered(lower)177   -22.8472  8431.0823  -0.003 0.997838    
ordered(lower)180    -3.7205     1.0573  -3.519 0.000434 ***
ordered(lower)183   -22.8936  8944.4024  -0.003 0.997958    
ordered(lower)186   -22.8333  8944.2978  -0.003 0.997963    
ordered(lower)189   -22.8337  9559.9126  -0.002 0.998094    
ordered(lower)192   -22.8337  9559.9126  -0.002 0.998094    
ordered(lower)195   -22.8337  9559.9126  -0.002 0.998094    
ordered(lower)198   -22.8936 10328.1063  -0.002 0.998231    
ordered(lower)201   -22.8936 10328.1063  -0.002 0.998231    
ordered(lower)204   -22.8936 10328.1063  -0.002 0.998231    
ordered(lower)207   -22.7370  9882.9134  -0.002 0.998164    
ordered(lower)210   -22.8174 11188.3739  -0.002 0.998373    
ordered(lower)213   -23.0246 14639.5599  -0.002 0.998745    
ordered(lower)216   -22.6215 14054.6481  -0.002 0.998716    
ordered(lower)219   -22.8936 17888.8048  -0.001 0.998979    
ordered(lower)222   -22.7325 17389.8900  -0.001 0.998957    
metastizedTRUE        0.8575     0.5013   1.711 0.087171 .  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 8421.80  on 1434  degrees of freedom
Residual deviance:  183.39  on 1358  degrees of freedom
AIC: 387.39

Number of Fisher Scoring iterations: 19</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">expand.grid</span>(
    <span class="dt">metastized =</span> <span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>),
    <span class="dt">lower =</span> <span class="dv">0</span><span class="op">:</span><span class="kw">max</span>(df1<span class="op">$</span>lower),
    <span class="dt">exposure =</span> M
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">predict</span>(m, <span class="dt">data =</span> ., <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>)</code></pre></div>
<pre><code>           1            2            3            4            5 
6.768991e-10 1.813697e-02 6.768991e-10 2.720545e-02 1.864419e-02 
           6            7            8            9           10 
6.768991e-10 2.720545e-02 2.796629e-02 9.683165e-03 6.768991e-10 
          11           12           13           14           15 
2.720545e-02 2.796629e-02 2.904950e-02 9.972872e-03 6.768991e-10 
          16           17           18           19           20 
2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 
          21           22           23           24           25 
2.871560e-10 1.154117e-02 1.186393e-02 1.232346e-02 1.269216e-02 
          26           27           28           29           30 
1.282001e-02 2.946672e-10 1.770402e-02 6.768991e-10 2.720545e-02 
          31           32           33           34           35 
2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 6.946049e-10 
          36           37           38           39           40 
6.259925e-02 6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 
          41           42           43           44           45 
2.991862e-02 3.022000e-02 6.946049e-10 6.259925e-02 4.444477e-02 
          46           47           48           49           50 
6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 
          51           52           53           54           55 
3.022000e-02 6.946049e-10 6.259925e-02 4.444477e-02 6.768991e-10 
          56           57           58           59           60 
2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 
          61           62           63           64           65 
6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 1.190485e-02 
          66           67           68           69           70 
6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 
          71           72           73           74           75 
3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 
          76           77           78           79           80 
3.571456e-02 2.439044e-02 6.768991e-10 2.720545e-02 2.796629e-02 
          81           82           83           84           85 
2.904950e-02 2.991862e-02 3.022000e-02 6.946049e-10 6.259925e-02 
          86           87           88           89           90 
6.666715e-02 6.980277e-10 3.571456e-02 3.658566e-02 7.080712e-10 
          91           92           93           94           95 
2.597425e-02 6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 
          96           97           98           99          100 
2.991862e-02 3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 
         101          102          103          104          105 
6.980277e-10 3.571456e-02 3.658566e-02 7.080712e-10 5.194849e-02 
         106          107          108          109          110 
2.871560e-10 1.154117e-02 1.186393e-02 1.232346e-02 1.269216e-02 
         111          112          113          114          115 
1.282001e-02 2.946672e-10 2.655602e-02 2.828172e-02 2.961192e-10 
         116          117          118          119          120 
1.515093e-02 1.552047e-02 3.003799e-10 3.305660e-02 3.053118e-10 
         121          122          123          124          125 
2.306338e-02 6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 
         126          127          128          129          130 
2.991862e-02 3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 
         131          132          133          134          135 
6.980277e-10 3.571456e-02 3.658566e-02 7.080712e-10 7.792274e-02 
         136          137          138          139          140 
7.196969e-10 8.154930e-02 6.768991e-10 2.720545e-02 2.796629e-02 
         141          142          143          144          145 
2.904950e-02 2.991862e-02 3.022000e-02 6.946049e-10 6.259925e-02 
         146          147          148          149          150 
6.666715e-02 6.980277e-10 3.571456e-02 3.658566e-02 7.080712e-10 
         151          152          153          154          155 
7.792274e-02 7.196969e-10 8.154930e-02 2.910078e-02 6.768991e-10 
         156          157          158          159          160 
2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 
         161          162          163          164          165 
6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 3.571456e-02 
         166          167          168          169          170 
3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 8.154930e-02 
         171          172          173          174          175 
4.365117e-02 7.209610e-10 7.209610e-10 3.042904e-02 6.768991e-10 
         176          177          178          179          180 
2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 
         181          182          183          184          185 
6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 3.571456e-02 
         186          187          188          189          190 
3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 8.154930e-02 
         191          192          193          194          195 
4.365117e-02 7.209610e-10 7.209610e-10 4.564356e-02 1.620045e-02 
         196          197          198          199          200 
6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 
         201          202          203          204          205 
3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 
         206          207          208          209          210 
3.571456e-02 3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 
         211          212          213          214          215 
8.154930e-02 4.365117e-02 7.209610e-10 7.209610e-10 4.564356e-02 
         216          217          218          219          220 
4.860135e-02 7.363184e-10 6.697174e-02 2.871560e-10 1.154117e-02 
         221          222          223          224          225 
1.186393e-02 1.232346e-02 1.269216e-02 1.282001e-02 2.946672e-10 
         226          227          228          229          230 
2.655602e-02 2.828172e-02 2.961192e-10 1.515093e-02 1.552047e-02 
         231          232          233          234          235 
3.003799e-10 3.305660e-02 3.053118e-10 3.459507e-02 1.851782e-02 
         236          237          238          239          240 
3.058481e-10 3.058481e-10 1.936304e-02 2.061780e-02 3.123630e-10 
         241          242          243          244          245 
4.261640e-02 2.871560e-10 1.154117e-02 1.186393e-02 1.232346e-02 
         246          247          248          249          250 
1.269216e-02 1.282001e-02 2.946672e-10 2.655602e-02 2.828172e-02 
         251          252          253          254          255 
2.961192e-10 1.515093e-02 1.552047e-02 3.003799e-10 3.305660e-02 
         256          257          258          259          260 
3.053118e-10 3.459507e-02 1.851782e-02 3.058481e-10 3.058481e-10 
         261          262          263          264          265 
1.936304e-02 2.061780e-02 3.123630e-10 4.261640e-02 7.768855e-03 
         266          267          268          269          270 
6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 
         271          272          273          274          275 
3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 
         276          277          278          279          280 
3.571456e-02 3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 
         281          282          283          284          285 
8.154930e-02 4.365117e-02 7.209610e-10 7.209610e-10 4.564356e-02 
         286          287          288          289          290 
4.860135e-02 7.363184e-10 1.004576e-01 3.662630e-02 6.768991e-10 
         291          292          293          294          295 
2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 
         296          297          298          299          300 
6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 3.571456e-02 
         301          302          303          304          305 
3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 8.154930e-02 
         306          307          308          309          310 
4.365117e-02 7.209610e-10 7.209610e-10 4.564356e-02 4.860135e-02 
         311          312          313          314          315 
7.363184e-10 1.004576e-01 5.493945e-02 7.245432e-10 2.549888e-10 
         316          317          318          319          320 
2.871560e-10 1.154117e-02 1.186393e-02 1.232346e-02 1.269216e-02 
         321          322          323          324          325 
1.282001e-02 2.946672e-10 2.655602e-02 2.828172e-02 2.961192e-10 
         326          327          328          329          330 
1.515093e-02 1.552047e-02 3.003799e-10 3.305660e-02 3.053118e-10 
         331          332          333          334          335 
3.459507e-02 1.851782e-02 3.058481e-10 3.058481e-10 1.936304e-02 
         336          337          338          339          340 
2.061780e-02 3.123630e-10 4.261640e-02 2.330656e-02 3.073677e-10 
         341          342          343          344          345 
3.245161e-10 3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 
         346          347          348          349          350 
3.114812e-10 3.114812e-10 3.114812e-10 1.102263e-10 2.871560e-10 
         351          352          353          354          355 
1.154117e-02 1.186393e-02 1.232346e-02 1.269216e-02 1.282001e-02 
         356          357          358          359          360 
2.946672e-10 2.655602e-02 2.828172e-02 2.961192e-10 1.515093e-02 
         361          362          363          364          365 
1.552047e-02 3.003799e-10 3.305660e-02 3.053118e-10 3.459507e-02 
         366          367          368          369          370 
1.851782e-02 3.058481e-10 3.058481e-10 1.936304e-02 2.061780e-02 
         371          372          373          374          375 
3.123630e-10 4.261640e-02 2.330656e-02 3.073677e-10 3.245161e-10 
         376          377          378          379          380 
3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 
         381          382          383          384          385 
3.114812e-10 3.114812e-10 2.204526e-10 6.768991e-10 2.720545e-02 
         386          387          388          389          390 
2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 6.946049e-10 
         391          392          393          394          395 
6.259925e-02 6.666715e-02 6.980277e-10 3.571456e-02 3.658566e-02 
         396          397          398          399          400 
7.080712e-10 7.792274e-02 7.196969e-10 8.154930e-02 4.365117e-02 
         401          402          403          404          405 
7.209610e-10 7.209610e-10 4.564356e-02 4.860135e-02 7.363184e-10 
         406          407          408          409          410 
1.004576e-01 5.493945e-02 7.245432e-10 7.649664e-10 7.342398e-10 
         411          412          413          414          415 
7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 
         416          417          418          419          420 
7.342398e-10 7.794934e-10 6.988121e-10 6.768991e-10 2.720545e-02 
         421          422          423          424          425 
2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 6.946049e-10 
         426          427          428          429          430 
6.259925e-02 6.666715e-02 6.980277e-10 3.571456e-02 3.658566e-02 
         431          432          433          434          435 
7.080712e-10 7.792274e-02 7.196969e-10 8.154930e-02 4.365117e-02 
         436          437          438          439          440 
7.209610e-10 7.209610e-10 4.564356e-02 4.860135e-02 7.363184e-10 
         441          442          443          444          445 
1.004576e-01 5.493945e-02 7.245432e-10 7.649664e-10 7.342398e-10 
         446          447          448          449          450 
7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 
         451          452          453          454          455 
7.342398e-10 7.794934e-10 6.988121e-10 4.839293e-10 6.768991e-10 
         456          457          458          459          460 
2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 
         461          462          463          464          465 
6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 3.571456e-02 
         466          467          468          469          470 
3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 8.154930e-02 
         471          472          473          474          475 
4.365117e-02 7.209610e-10 7.209610e-10 4.564356e-02 4.860135e-02 
         476          477          478          479          480 
7.363184e-10 1.004576e-01 5.493945e-02 7.245432e-10 7.649664e-10 
         481          482          483          484          485 
7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 
         486          487          488          489          490 
7.342398e-10 7.342398e-10 7.794934e-10 6.988121e-10 7.258940e-10 
         491          492          493          494          495 
2.569465e-10 6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 
         496          497          498          499          500 
2.991862e-02 3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 
         501          502          503          504          505 
6.980277e-10 3.571456e-02 3.658566e-02 7.080712e-10 7.792274e-02 
         506          507          508          509          510 
7.196969e-10 8.154930e-02 4.365117e-02 7.209610e-10 7.209610e-10 
         511          512          513          514          515 
4.564356e-02 4.860135e-02 7.363184e-10 1.004576e-01 5.493945e-02 
         516          517          518          519          520 
7.245432e-10 7.649664e-10 7.342398e-10 7.342398e-10 7.342398e-10 
         521          522          523          524          525 
7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.794934e-10 
         526          527          528          529          530 
6.988121e-10 7.258940e-10 7.708395e-10 5.459110e-02 6.768991e-10 
         531          532          533          534          535 
2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 
         536          537          538          539          540 
6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 3.571456e-02 
         541          542          543          544          545 
3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 8.154930e-02 
         546          547          548          549          550 
4.365117e-02 7.209610e-10 7.209610e-10 4.564356e-02 4.860135e-02 
         551          552          553          554          555 
7.363184e-10 1.004576e-01 5.493945e-02 7.245432e-10 7.649664e-10 
         556          557          558          559          560 
7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 
         561          562          563          564          565 
7.342398e-10 7.342398e-10 7.794934e-10 6.988121e-10 7.258940e-10 
         566          567          568          569          570 
7.708395e-10 8.188665e-02 5.122261e-10 6.768991e-10 2.720545e-02 
         571          572          573          574          575 
2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 6.946049e-10 
         576          577          578          579          580 
6.259925e-02 6.666715e-02 6.980277e-10 3.571456e-02 3.658566e-02 
         581          582          583          584          585 
7.080712e-10 7.792274e-02 7.196969e-10 8.154930e-02 4.365117e-02 
         586          587          588          589          590 
7.209610e-10 7.209610e-10 4.564356e-02 4.860135e-02 7.363184e-10 
         591          592          593          594          595 
1.004576e-01 5.493945e-02 7.245432e-10 7.649664e-10 7.342398e-10 
         596          597          598          599          600 
7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 
         601          602          603          604          605 
7.342398e-10 7.794934e-10 6.988121e-10 7.258940e-10 7.708395e-10 
         606          607          608          609          610 
8.188665e-02 7.683391e-10 3.374273e-02 6.768991e-10 2.720545e-02 
         611          612          613          614          615 
2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 6.946049e-10 
         616          617          618          619          620 
6.259925e-02 6.666715e-02 6.980277e-10 3.571456e-02 3.658566e-02 
         621          622          623          624          625 
7.080712e-10 7.792274e-02 7.196969e-10 8.154930e-02 4.365117e-02 
         626          627          628          629          630 
7.209610e-10 7.209610e-10 4.564356e-02 4.860135e-02 7.363184e-10 
         631          632          633          634          635 
1.004576e-01 5.493945e-02 7.245432e-10 7.649664e-10 7.342398e-10 
         636          637          638          639          640 
7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 
         641          642          643          644          645 
7.342398e-10 7.794934e-10 6.988121e-10 7.258940e-10 7.708395e-10 
         646          647          648          649          650 
8.188665e-02 7.683391e-10 1.012282e-01 7.823293e-10 7.823293e-10 
         651          652          653          654          655 
7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 
         656          657          658          659          660 
7.236935e-02 6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 
         661          662          663          664          665 
2.991862e-02 3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 
         666          667          668          669          670 
6.980277e-10 3.571456e-02 3.658566e-02 7.080712e-10 7.792274e-02 
         671          672          673          674          675 
7.196969e-10 8.154930e-02 4.365117e-02 7.209610e-10 7.209610e-10 
         676          677          678          679          680 
4.564356e-02 4.860135e-02 7.363184e-10 1.004576e-01 5.493945e-02 
         681          682          683          684          685 
7.245432e-10 7.649664e-10 7.342398e-10 7.342398e-10 7.342398e-10 
         686          687          688          689          690 
7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.794934e-10 
         691          692          693          694          695 
6.988121e-10 7.258940e-10 7.708395e-10 8.188665e-02 7.683391e-10 
         696          697          698          699          700 
1.012282e-01 7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 
         701          702          703          704          705 
7.823293e-10 7.823293e-10 7.823293e-10 1.085540e-01 2.987361e-10 
         706          707          708          709          710 
2.871560e-10 1.154117e-02 1.186393e-02 1.232346e-02 1.269216e-02 
         711          712          713          714          715 
1.282001e-02 2.946672e-10 2.655602e-02 2.828172e-02 2.961192e-10 
         716          717          718          719          720 
1.515093e-02 1.552047e-02 3.003799e-10 3.305660e-02 3.053118e-10 
         721          722          723          724          725 
3.459507e-02 1.851782e-02 3.058481e-10 3.058481e-10 1.936304e-02 
         726          727          728          729          730 
2.061780e-02 3.123630e-10 4.261640e-02 2.330656e-02 3.073677e-10 
         731          732          733          734          735 
3.245161e-10 3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 
         736          737          738          739          740 
3.114812e-10 3.114812e-10 3.114812e-10 3.306788e-10 2.964520e-10 
         741          742          743          744          745 
3.079407e-10 3.270077e-10 3.473818e-02 3.259469e-10 4.294331e-02 
         746          747          748          749          750 
3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 
         751          752          753          754          755 
3.318819e-10 3.318819e-10 4.605108e-02 3.801919e-10 1.947087e-02 
         756          757          758          759          760 
6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 
         761          762          763          764          765 
3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 
         766          767          768          769          770 
3.571456e-02 3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 
         771          772          773          774          775 
8.154930e-02 4.365117e-02 7.209610e-10 7.209610e-10 4.564356e-02 
         776          777          778          779          780 
4.860135e-02 7.363184e-10 1.004576e-01 5.493945e-02 7.245432e-10 
         781          782          783          784          785 
7.649664e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 
         786          787          788          789          790 
7.342398e-10 7.342398e-10 7.342398e-10 7.794934e-10 6.988121e-10 
         791          792          793          794          795 
7.258940e-10 7.708395e-10 8.188665e-02 7.683391e-10 1.012282e-01 
         796          797          798          799          800 
7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 
         801          802          803          804          805 
7.823293e-10 7.823293e-10 1.085540e-01 8.962082e-10 1.376932e-01 
         806          807          808          809          810 
8.071699e-10 8.071699e-10 8.071699e-10 8.071699e-10 2.871560e-10 
         811          812          813          814          815 
1.154117e-02 1.186393e-02 1.232346e-02 1.269216e-02 1.282001e-02 
         816          817          818          819          820 
2.946672e-10 2.655602e-02 2.828172e-02 2.961192e-10 1.515093e-02 
         821          822          823          824          825 
1.552047e-02 3.003799e-10 3.305660e-02 3.053118e-10 3.459507e-02 
         826          827          828          829          830 
1.851782e-02 3.058481e-10 3.058481e-10 1.936304e-02 2.061780e-02 
         831          832          833          834          835 
3.123630e-10 4.261640e-02 2.330656e-02 3.073677e-10 3.245161e-10 
         836          837          838          839          840 
3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 
         841          842          843          844          845 
3.114812e-10 3.114812e-10 3.306788e-10 2.964520e-10 3.079407e-10 
         846          847          848          849          850 
3.270077e-10 3.473818e-02 3.259469e-10 4.294331e-02 3.318819e-10 
         851          852          853          854          855 
3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 
         856          857          858          859          860 
3.318819e-10 4.605108e-02 3.801919e-10 5.841260e-02 3.424198e-10 
         861          862          863          864          865 
3.424198e-10 3.424198e-10 3.424198e-10 3.586760e-10 3.586760e-10 
         866          867          868          869          870 
3.586760e-10 3.586760e-10 3.586760e-10 3.586760e-10 2.422068e-02 
         871          872          873          874          875 
6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 
         876          877          878          879          880 
3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 
         881          882          883          884          885 
3.571456e-02 3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 
         886          887          888          889          890 
8.154930e-02 4.365117e-02 7.209610e-10 7.209610e-10 4.564356e-02 
         891          892          893          894          895 
4.860135e-02 7.363184e-10 1.004576e-01 5.493945e-02 7.245432e-10 
         896          897          898          899          900 
7.649664e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 
         901          902          903          904          905 
7.342398e-10 7.342398e-10 7.342398e-10 7.794934e-10 6.988121e-10 
         906          907          908          909          910 
7.258940e-10 7.708395e-10 8.188665e-02 7.683391e-10 1.012282e-01 
         911          912          913          914          915 
7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 
         916          917          918          919          920 
7.823293e-10 7.823293e-10 1.085540e-01 8.962082e-10 1.376932e-01 
         921          922          923          924          925 
8.071699e-10 8.071699e-10 8.071699e-10 8.071699e-10 8.454899e-10 
         926          927          928          929          930 
8.454899e-10 8.454899e-10 8.454899e-10 8.454899e-10 8.454899e-10 
         931          932          933          934          935 
1.712828e-01 8.071699e-10 5.715692e-10 2.871560e-10 1.154117e-02 
         936          937          938          939          940 
1.186393e-02 1.232346e-02 1.269216e-02 1.282001e-02 2.946672e-10 
         941          942          943          944          945 
2.655602e-02 2.828172e-02 2.961192e-10 1.515093e-02 1.552047e-02 
         946          947          948          949          950 
3.003799e-10 3.305660e-02 3.053118e-10 3.459507e-02 1.851782e-02 
         951          952          953          954          955 
3.058481e-10 3.058481e-10 1.936304e-02 2.061780e-02 3.123630e-10 
         956          957          958          959          960 
4.261640e-02 2.330656e-02 3.073677e-10 3.245161e-10 3.114812e-10 
         961          962          963          964          965 
3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 
         966          967          968          969          970 
3.114812e-10 3.306788e-10 2.964520e-10 3.079407e-10 3.270077e-10 
         971          972          973          974          975 
3.473818e-02 3.259469e-10 4.294331e-02 3.318819e-10 3.318819e-10 
         976          977          978          979          980 
3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 
         981          982          983          984          985 
4.605108e-02 3.801919e-10 5.841260e-02 3.424198e-10 3.424198e-10 
         986          987          988          989          990 
3.424198e-10 3.424198e-10 3.586760e-10 3.586760e-10 3.586760e-10 
         991          992          993          994          995 
3.586760e-10 3.586760e-10 3.586760e-10 7.266205e-02 3.424198e-10 
         996          997          998          999         1000 
3.637090e-10 3.635642e-10 3.635642e-10 3.635642e-10 2.871560e-10 
        1001         1002         1003         1004         1005 
1.154117e-02 1.186393e-02 1.232346e-02 1.269216e-02 1.282001e-02 
        1006         1007         1008         1009         1010 
2.946672e-10 2.655602e-02 2.828172e-02 2.961192e-10 1.515093e-02 
        1011         1012         1013         1014         1015 
1.552047e-02 3.003799e-10 3.305660e-02 3.053118e-10 3.459507e-02 
        1016         1017         1018         1019         1020 
1.851782e-02 3.058481e-10 3.058481e-10 1.936304e-02 2.061780e-02 
        1021         1022         1023         1024         1025 
3.123630e-10 4.261640e-02 2.330656e-02 3.073677e-10 3.245161e-10 
        1026         1027         1028         1029         1030 
3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 
        1031         1032         1033         1034         1035 
3.114812e-10 3.114812e-10 3.306788e-10 2.964520e-10 3.079407e-10 
        1036         1037         1038         1039         1040 
3.270077e-10 3.473818e-02 3.259469e-10 4.294331e-02 3.318819e-10 
        1041         1042         1043         1044         1045 
3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 
        1046         1047         1048         1049         1050 
3.318819e-10 4.605108e-02 3.801919e-10 5.841260e-02 3.424198e-10 
        1051         1052         1053         1054         1055 
3.424198e-10 3.424198e-10 3.424198e-10 3.586760e-10 3.586760e-10 
        1056         1057         1058         1059         1060 
3.586760e-10 3.586760e-10 3.586760e-10 3.586760e-10 7.266205e-02 
        1061         1062         1063         1064         1065 
3.424198e-10 3.637090e-10 3.635642e-10 3.635642e-10 3.635642e-10 
        1066         1067         1068         1069         1070 
3.424198e-10 3.424198e-10 3.424198e-10 1.334908e-10 2.871560e-10 
        1071         1072         1073         1074         1075 
1.154117e-02 1.186393e-02 1.232346e-02 1.269216e-02 1.282001e-02 
        1076         1077         1078         1079         1080 
2.946672e-10 2.655602e-02 2.828172e-02 2.961192e-10 1.515093e-02 
        1081         1082         1083         1084         1085 
1.552047e-02 3.003799e-10 3.305660e-02 3.053118e-10 3.459507e-02 
        1086         1087         1088         1089         1090 
1.851782e-02 3.058481e-10 3.058481e-10 1.936304e-02 2.061780e-02 
        1091         1092         1093         1094         1095 
3.123630e-10 4.261640e-02 2.330656e-02 3.073677e-10 3.245161e-10 
        1096         1097         1098         1099         1100 
3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 
        1101         1102         1103         1104         1105 
3.114812e-10 3.114812e-10 3.306788e-10 2.964520e-10 3.079407e-10 
        1106         1107         1108         1109         1110 
3.270077e-10 3.473818e-02 3.259469e-10 4.294331e-02 3.318819e-10 
        1111         1112         1113         1114         1115 
3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 
        1116         1117         1118         1119         1120 
3.318819e-10 4.605108e-02 3.801919e-10 5.841260e-02 3.424198e-10 
        1121         1122         1123         1124         1125 
3.424198e-10 3.424198e-10 3.424198e-10 3.586760e-10 3.586760e-10 
        1126         1127         1128         1129         1130 
3.586760e-10 3.586760e-10 3.586760e-10 3.586760e-10 7.266205e-02 
        1131         1132         1133         1134         1135 
3.424198e-10 3.637090e-10 3.635642e-10 3.635642e-10 3.635642e-10 
        1136         1137         1138         1139         1140 
3.424198e-10 3.424198e-10 3.424198e-10 4.004724e-10 2.463583e-10 
        1141         1142         1143         1144         1145 
6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 
        1146         1147         1148         1149         1150 
3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 
        1151         1152         1153         1154         1155 
3.571456e-02 3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 
        1156         1157         1158         1159         1160 
8.154930e-02 4.365117e-02 7.209610e-10 7.209610e-10 4.564356e-02 
        1161         1162         1163         1164         1165 
4.860135e-02 7.363184e-10 1.004576e-01 5.493945e-02 7.245432e-10 
        1166         1167         1168         1169         1170 
7.649664e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 
        1171         1172         1173         1174         1175 
7.342398e-10 7.342398e-10 7.342398e-10 7.794934e-10 6.988121e-10 
        1176         1177         1178         1179         1180 
7.258940e-10 7.708395e-10 8.188665e-02 7.683391e-10 1.012282e-01 
        1181         1182         1183         1184         1185 
7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 
        1186         1187         1188         1189         1190 
7.823293e-10 7.823293e-10 1.085540e-01 8.962082e-10 1.376932e-01 
        1191         1192         1193         1194         1195 
8.071699e-10 8.071699e-10 8.071699e-10 8.071699e-10 8.454899e-10 
        1196         1197         1198         1199         1200 
8.454899e-10 8.454899e-10 8.454899e-10 8.454899e-10 8.454899e-10 
        1201         1202         1203         1204         1205 
1.712828e-01 8.071699e-10 8.573538e-10 8.570126e-10 8.570126e-10 
        1206         1207         1208         1209         1210 
8.570126e-10 8.071699e-10 8.071699e-10 8.071699e-10 9.440144e-10 
        1211         1212         1213         1214         1215 
5.807287e-10 6.768991e-10 2.720545e-02 2.796629e-02 2.904950e-02 
        1216         1217         1218         1219         1220 
2.991862e-02 3.022000e-02 6.946049e-10 6.259925e-02 6.666715e-02 
        1221         1222         1223         1224         1225 
6.980277e-10 3.571456e-02 3.658566e-02 7.080712e-10 7.792274e-02 
        1226         1227         1228         1229         1230 
7.196969e-10 8.154930e-02 4.365117e-02 7.209610e-10 7.209610e-10 
        1231         1232         1233         1234         1235 
4.564356e-02 4.860135e-02 7.363184e-10 1.004576e-01 5.493945e-02 
        1236         1237         1238         1239         1240 
7.245432e-10 7.649664e-10 7.342398e-10 7.342398e-10 7.342398e-10 
        1241         1242         1243         1244         1245 
7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.794934e-10 
        1246         1247         1248         1249         1250 
6.988121e-10 7.258940e-10 7.708395e-10 8.188665e-02 7.683391e-10 
        1251         1252         1253         1254         1255 
1.012282e-01 7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 
        1256         1257         1258         1259         1260 
7.823293e-10 7.823293e-10 7.823293e-10 1.085540e-01 8.962082e-10 
        1261         1262         1263         1264         1265 
1.376932e-01 8.071699e-10 8.071699e-10 8.071699e-10 8.071699e-10 
        1266         1267         1268         1269         1270 
8.454899e-10 8.454899e-10 8.454899e-10 8.454899e-10 8.454899e-10 
        1271         1272         1273         1274         1275 
8.454899e-10 1.712828e-01 8.071699e-10 8.573538e-10 8.570126e-10 
        1276         1277         1278         1279         1280 
8.570126e-10 8.570126e-10 8.071699e-10 8.071699e-10 8.071699e-10 
        1281         1282         1283         1284         1285 
9.440144e-10 8.710930e-10 7.080712e-10 3.532117e-10 2.871560e-10 
        1286         1287         1288         1289         1290 
1.154117e-02 1.186393e-02 1.232346e-02 1.269216e-02 1.282001e-02 
        1291         1292         1293         1294         1295 
2.946672e-10 2.655602e-02 2.828172e-02 2.961192e-10 1.515093e-02 
        1296         1297         1298         1299         1300 
1.552047e-02 3.003799e-10 3.305660e-02 3.053118e-10 3.459507e-02 
        1301         1302         1303         1304         1305 
1.851782e-02 3.058481e-10 3.058481e-10 1.936304e-02 2.061780e-02 
        1306         1307         1308         1309         1310 
3.123630e-10 4.261640e-02 2.330656e-02 3.073677e-10 3.245161e-10 
        1311         1312         1313         1314         1315 
3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 3.114812e-10 
        1316         1317         1318         1319         1320 
3.114812e-10 3.114812e-10 3.306788e-10 2.964520e-10 3.079407e-10 
        1321         1322         1323         1324         1325 
3.270077e-10 3.473818e-02 3.259469e-10 4.294331e-02 3.318819e-10 
        1326         1327         1328         1329         1330 
3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 3.318819e-10 
        1331         1332         1333         1334         1335 
3.318819e-10 4.605108e-02 3.801919e-10 5.841260e-02 3.424198e-10 
        1336         1337         1338         1339         1340 
3.424198e-10 3.424198e-10 3.424198e-10 3.586760e-10 3.586760e-10 
        1341         1342         1343         1344         1345 
3.586760e-10 3.586760e-10 3.586760e-10 3.586760e-10 7.266205e-02 
        1346         1347         1348         1349         1350 
3.424198e-10 3.637090e-10 3.635642e-10 3.635642e-10 3.635642e-10 
        1351         1352         1353         1354         1355 
3.424198e-10 3.424198e-10 3.424198e-10 4.004724e-10 3.695375e-10 
        1356         1357         1358         1359         1360 
3.003799e-10 4.495213e-10 3.424198e-10 2.681949e-10 6.768991e-10 
        1361         1362         1363         1364         1365 
2.720545e-02 2.796629e-02 2.904950e-02 2.991862e-02 3.022000e-02 
        1366         1367         1368         1369         1370 
6.946049e-10 6.259925e-02 6.666715e-02 6.980277e-10 3.571456e-02 
        1371         1372         1373         1374         1375 
3.658566e-02 7.080712e-10 7.792274e-02 7.196969e-10 8.154930e-02 
        1376         1377         1378         1379         1380 
4.365117e-02 7.209610e-10 7.209610e-10 4.564356e-02 4.860135e-02 
        1381         1382         1383         1384         1385 
7.363184e-10 1.004576e-01 5.493945e-02 7.245432e-10 7.649664e-10 
        1386         1387         1388         1389         1390 
7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 7.342398e-10 
        1391         1392         1393         1394         1395 
7.342398e-10 7.342398e-10 7.794934e-10 6.988121e-10 7.258940e-10 
        1396         1397         1398         1399         1400 
7.708395e-10 8.188665e-02 7.683391e-10 1.012282e-01 7.823293e-10 
        1401         1402         1403         1404         1405 
7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 7.823293e-10 
        1406         1407         1408         1409         1410 
7.823293e-10 1.085540e-01 8.962082e-10 1.376932e-01 8.071699e-10 
        1411         1412         1413         1414         1415 
8.071699e-10 8.071699e-10 8.071699e-10 8.454899e-10 8.454899e-10 
        1416         1417         1418         1419         1420 
8.454899e-10 8.454899e-10 8.454899e-10 8.454899e-10 1.712828e-01 
        1421         1422         1423         1424         1425 
8.071699e-10 8.573538e-10 8.570126e-10 8.570126e-10 8.570126e-10 
        1426         1427         1428         1429         1430 
8.071699e-10 8.071699e-10 8.071699e-10 9.440144e-10 8.710930e-10 
        1431         1432         1433         1434 
7.080712e-10 1.059635e-09 8.071699e-10 9.483044e-10 </code></pre>
<h3 id="the-survival-package">The survival package</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cx &lt;-<span class="st"> </span><span class="kw">coxph</span>(
  <span class="dt">formula =</span> <span class="kw">Surv</span>(months, event) <span class="op">~</span><span class="st"> </span>metastized,
  <span class="dt">data =</span> df
)

cx</code></pre></div>
<pre><code>Call:
coxph(formula = Surv(months, event) ~ metastized, data = df)

                coef exp(coef) se(coef)   z    p
metastizedTRUE 0.852     2.343    0.502 1.7 0.09

Likelihood ratio test=3.35  on 1 df, p=0.07
n= 44, number of events= 26</code></pre>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 22</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_22.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_22.html</id>
    <published>2018-09-09T00:00:00Z</published>
    <updated>2018-09-09T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 22</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  9, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/basketball.html">basketball</a>, <a href="/tags/prior%20choice.html">prior choice</a>, <a href="/tags/weakly%0Ainformative%20prior.html">weakly
informative prior</a>, <a href="/tags/noninformative%20prior.html">noninformative prior</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 22, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial} \DeclareMathOperator{\dbern}{Bernoulli} \DeclareMathOperator{\dpois}{Poisson} \DeclareMathOperator{\dnorm}{Normal} \DeclareMathOperator{\dcauchy}{Cauchy} \DeclareMathOperator{\dexponential}{Exp} \DeclareMathOperator{\dgamma}{Gamma} \DeclareMathOperator{\dinvgamma}{InvGamma} \DeclareMathOperator{\invlogit}{InvLogit} \DeclareMathOperator{\logit}{Logit} \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Suppose you have a random sample of 100 college students in a basketball study. Each student takes 100 free-throws to establish a baseline success probability, <span class="math inline">\(\phi_0\)</span>. The students then take 50 practice free-throws per day for a month. After this month is up, each takes 100 shots for a final measurement of success probability, <span class="math inline">\(\phi_1\)</span>. We wish to estimate the increase in success probability, <span class="math inline">\(\theta := \phi_1 - \phi_0\)</span>.</p>
<p>We could use the uniform distribution on the range of theoretically possible values <span class="math inline">\([-1, 1]\)</span> as a ‘non-informative’ prior, i.e. every level of increase is equally likely.</p>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/noninformative_prior-1..svg" />
</figure>
<p>To construct an informative prior, I had to do a bit of background reading as I have next to zero basketball knowledge. After some google-fu, it seems the <a href="https://www.basketball-reference.com/leaders/ft_pct_career.html">best of the best</a> have a free-throw success rate of around 80-90%, and the <a href="https://abcnews.go.com/Sports/free-throws-easy-consequences-failing/story?id=40769445">worst of the best</a> around 50-60%. This latter estimate probably lies on the upper extreme for random college students. From watching some <a href="https://www.youtube.com/watch?v=LFF6_5hyokU">free throw videos</a>, I would guess that I would have a success rate of about 10% (baseline).</p>
<p>Let’s model the baseline average as beta distributed around a mean of 10% and upper extreme below 40%.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu0 &lt;-<span class="st"> </span><span class="fl">0.10</span>
n0 &lt;-<span class="st"> </span><span class="dv">15</span>

alpha0 &lt;-<span class="st"> </span>mu0 <span class="op">*</span><span class="st"> </span>n0
beta0 &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu0) <span class="op">*</span><span class="st"> </span>n0

<span class="kw">tibble</span>(
    <span class="dt">p =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>),
    <span class="dt">density =</span> <span class="kw">dbeta</span>(p, alpha0, beta0)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">aes</span>(p, density) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;white&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Average baseline success probability&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Density&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Baseline success probability simulation&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Beta({alpha0}, {beta0})&#39;</span>)
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/baseline_simulation-1..svg" />
</figure>
<p>With this assumption, there is a 0.286% chance of an average above 40%.</p>
<p>For the final estimate, the improvement could be quite significant given that random students are likely untrained (the better you get, the harder it is to improve). An average 15%% improvement seems plausible to me.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu1 &lt;-<span class="st"> </span>mu0 <span class="op">+</span><span class="st"> </span><span class="fl">0.15</span>
n1 &lt;-<span class="st"> </span><span class="dv">20</span>

alpha1 &lt;-<span class="st"> </span>mu1 <span class="op">*</span><span class="st"> </span>n1
beta1 &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu1) <span class="op">*</span><span class="st"> </span>n1

<span class="kw">tibble</span>(
    <span class="dt">p =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>),
    <span class="dt">density =</span> <span class="kw">dbeta</span>(p, alpha1, beta1)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">aes</span>(p, density) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;white&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Average final success probability&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Density&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Final success probability simulation&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Beta({alpha1}, {beta1})&#39;</span>)
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/final_simulation-1..svg" />
</figure>
<p>With the above assumptions, the distribution of the average increase is shown below. The bulk of the mass is above 0, which makes sense as most should improve through practice. There is also some chance of a decrease, with -25%% being fairly extreme.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">increase &lt;-<span class="st"> </span><span class="kw">tibble</span>(
    <span class="dt">phi0 =</span> <span class="kw">rbeta</span>(<span class="dv">10000</span>, alpha0, beta0),
    <span class="dt">phi1 =</span> <span class="kw">rbeta</span>(<span class="dv">10000</span>, alpha1, beta1),
    <span class="dt">theta =</span> phi1 <span class="op">-</span><span class="st"> </span>phi0
  ) 

increase <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">aes</span>(theta) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">colour =</span> <span class="st">&#39;dark orange&#39;</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Average increase in success probability (percentage points)&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Count&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Average increase in success probability simulation&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Beta({alpha1}, {beta1}) - Beta({alpha0}, {beta0})&#39;</span>)
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/increase_simulation-1..svg" />
</figure>
<p>We could approximate this as a beta distribution on <span class="math inline">\([-1, 1]\)</span> to ensure the prior is bounded. In this case, we can probably get away with using a normal distribution since the probability of exceeding the bounds is negligible.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu &lt;-<span class="st"> </span>mu1 <span class="op">-</span><span class="st"> </span>mu0
sigma &lt;-<span class="st"> </span><span class="kw">sd</span>(increase<span class="op">$</span>theta)

<span class="kw">tibble</span>(
    <span class="dt">theta =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.01</span>),
    <span class="dt">density =</span> <span class="kw">dnorm</span>(theta, mu, sigma)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(theta, density) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;white&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">colour =</span> <span class="st">&#39;dark orange&#39;</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Average increase in success probability (percentage points)&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Density&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Strongly informative prior&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Normal(μ = {signif(mu, digits = 2)}, σ = {signif(sigma, digits = 2)})&#39;</span>)
  ) <span class="op">+</span>
<span class="st">  </span><span class="ot">NULL</span></code></pre></div>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/informative_prior-1..svg" />
</figure>
<p>The probability that this normal distribution exceeds 1 is 0.000000000104%. A subjective prior for the average increase in success probability would thus be a <span class="math inline">\(\dnorm(0.15, 0.12)\)</span> prior.</p>
<p>Finally, let’s construct a weakly informative prior. We’ll again use the beta distribution scaled to the interval <span class="math inline">\([-1, 1]\)</span>, with a mean of 0 so that an increase can be entirely attributed to the data and not to the prior. Since the best of the pros have a success probability around 90%, we’d expect the increase of 100 random students to be below this value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alpha &lt;-<span class="st"> </span><span class="dv">5</span>
beta &lt;-<span class="st"> </span><span class="dv">5</span>

<span class="kw">tibble</span>(
    <span class="dt">theta =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.01</span>),
    <span class="dt">density =</span> <span class="kw">dbeta</span>(<span class="fl">0.5</span> <span class="op">+</span><span class="st"> </span>theta <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, alpha, beta)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(theta, density) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;white&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">colour =</span> <span class="st">&#39;dark orange&#39;</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>), <span class="dt">labels =</span> percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Average increase in success probability (percentage points)&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Density&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Weakly informative prior&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;Beta({alpha}, {beta})&#39;</span>)
  ) <span class="op">+</span>
<span class="st">  </span><span class="ot">NULL</span></code></pre></div>
<figure>
<img src="chapter_02_exercise_22_files/figure-markdown/weakly_informative_prior-1..svg" />
</figure>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 21</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_21.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_21.html</id>
    <published>2018-09-09T00:00:00Z</published>
    <updated>2018-09-09T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 21</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  9, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/poisson.html">poisson</a>, <a href="/tags/gamma.html">gamma</a>, <a href="/tags/exposure.html">exposure</a>, <a href="/tags/election.html">election</a>, <a href="/tags/usa.html">usa</a>, <a href="/tags/obama.html">obama</a>, <a href="/tags/pew%20research%20center.html">pew research center</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 21, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial} \DeclareMathOperator{\dbern}{Bernoulli} \DeclareMathOperator{\dpois}{Poisson} \DeclareMathOperator{\dnorm}{Normal} \DeclareMathOperator{\dcauchy}{Cauchy} \DeclareMathOperator{\dexponential}{Exp} \DeclareMathOperator{\dgamma}{Gamma} \DeclareMathOperator{\dinvgamma}{InvGamma} \DeclareMathOperator{\invlogit}{InvLogit} \DeclareMathOperator{\logit}{Logit} \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>I wasn’t able to find any of the data for this question on the book’s website (as indicated in the book). However, the data are available on the <a href="http://www.people-press.org/2008/11/02/november-2008-election-weekend-survey/">Pew Research Center website</a>. I am unsure if the Pew version is the same as the version intended in the book.</p>
<h2 id="data-inspection">Data inspection</h2>
<h3 id="loading">Loading</h3>
<p>Unzipping the download into my local <code>data</code> directory gives three files of interest:</p>
<ul>
<li><p><code>ElectWkd08c.sav</code></p>
<p>The dataset in SPSS format.</p></li>
<li><p><code>ElecWknd08.que.doc</code></p>
<p>A description of the survey questions and their column names in the dataset.</p></li>
<li><p><code>readme.txt</code></p>
<p>A description of the columns in the dataset derived from the survey questions.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(foreign)

df0 &lt;-<span class="st"> </span><span class="kw">read.spss</span>(<span class="dt">file =</span> <span class="st">&#39;data/ElectWkd08c.sav&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>()

df0 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>()</code></pre></div>
<pre><code>[1] 3402</code></pre>
<p>There are many columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df0 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">colnames</span>()</code></pre></div>
<pre><code>  [1] &quot;psraid&quot;    &quot;attempt&quot;   &quot;fcall&quot;     &quot;refusal&quot;   &quot;int_date&quot; 
  [6] &quot;area&quot;      &quot;scregion&quot;  &quot;sfips&quot;     &quot;sstate&quot;    &quot;cdist&quot;    
 [11] &quot;msa&quot;       &quot;usr&quot;       &quot;usr1&quot;      &quot;sampzip&quot;   &quot;pdsgen&quot;   
 [16] &quot;pdsrace&quot;   &quot;zfips&quot;     &quot;zstate&quot;    &quot;zcregion&quot;  &quot;zdensity3&quot;
 [21] &quot;sdensity3&quot; &quot;file&quot;      &quot;sample&quot;    &quot;sex&quot;       &quot;qs1&quot;      
 [26] &quot;thought&quot;   &quot;q1&quot;        &quot;voter&quot;     &quot;regist&quot;    &quot;regicert&quot; 
 [31] &quot;planreg&quot;   &quot;precinct&quot;  &quot;q2&quot;        &quot;oftvote&quot;   &quot;where&quot;    
 [36] &quot;horse&quot;     &quot;q3&quot;        &quot;q3_1&quot;      &quot;q3_2&quot;      &quot;q3_3&quot;     
 [41] &quot;q3a&quot;       &quot;q3a_1&quot;     &quot;q3a_2&quot;     &quot;q3a_3&quot;     &quot;q3summ&quot;   
 [46] &quot;q3summ2&quot;   &quot;q3tot&quot;     &quot;q3atot&quot;    &quot;q3horse&quot;   &quot;q3b&quot;      
 [51] &quot;q3bfilt&quot;   &quot;q5&quot;        &quot;q6&quot;        &quot;swing&quot;     &quot;plan1&quot;    
 [56] &quot;plan2&quot;     &quot;plan3&quot;     &quot;q7&quot;        &quot;q8&quot;        &quot;q9&quot;       
 [61] &quot;q10a&quot;      &quot;q10b&quot;      &quot;q10c&quot;      &quot;q10d&quot;      &quot;q10e&quot;     
 [66] &quot;q10f&quot;      &quot;q10g&quot;      &quot;q10de&quot;     &quot;q11&quot;       &quot;q12&quot;      
 [71] &quot;q13&quot;       &quot;q14&quot;       &quot;q15&quot;       &quot;q15_1&quot;     &quot;q15_2&quot;    
 [76] &quot;q15_3&quot;     &quot;Q15tot&quot;    &quot;q16&quot;       &quot;q16a&quot;      &quot;q17&quot;      
 [81] &quot;age&quot;       &quot;recage&quot;    &quot;educ&quot;      &quot;receduc&quot;   &quot;hisp1&quot;    
 [86] &quot;race_1&quot;    &quot;race_2&quot;    &quot;race_3&quot;    &quot;race_4&quot;    &quot;racecmb&quot;  
 [91] &quot;racethn&quot;   &quot;marital&quot;   &quot;parent&quot;    &quot;relig&quot;     &quot;religos&quot;  
 [96] &quot;chr&quot;       &quot;born&quot;      &quot;attend&quot;    &quot;income&quot;    &quot;party&quot;    
[101] &quot;partyln&quot;   &quot;ideo&quot;      &quot;class&quot;     &quot;employ&quot;    &quot;pvote04a&quot; 
[106] &quot;pvote04b&quot;  &quot;primary&quot;   &quot;first1&quot;    &quot;first2&quot;    &quot;scale10&quot;  
[111] &quot;labor&quot;     &quot;ql1&quot;       &quot;ql2&quot;       &quot;qc1&quot;       &quot;qc2&quot;      
[116] &quot;zipcode&quot;   &quot;money10&quot;   &quot;website&quot;   &quot;isex&quot;      &quot;ihisp1&quot;   
[121] &quot;irace_1&quot;   &quot;irace_2&quot;   &quot;irace_3&quot;   &quot;irace_4&quot;   &quot;iraceth&quot;  
[126] &quot;iracecmb&quot;  &quot;regfinal&quot;  &quot;ballot&quot;    &quot;mccain&quot;    &quot;obama&quot;    
[131] &quot;sameday&quot;   &quot;battle&quot;    &quot;phoneuse&quot;  &quot;filter_$&quot;  &quot;lvs&quot;      
[136] &quot;lvswt67&quot;   &quot;llweight&quot;  &quot;coweight&quot;  &quot;wt_weth&quot;   &quot;wt_thfr&quot;  
[141] &quot;wt_frsa&quot;   &quot;wt_wefr&quot;   &quot;weight&quot;    &quot;unlvwt67&quot; </code></pre>
<h3 id="state">State</h3>
<p>For each state, we want to know how many label themselves as <code>Very liberal</code> and how many report supporting Obama. The state is given by the <code>sstate</code> column and doesn’t include Hawaii or Alaska.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df0 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(sstate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="kw">reorder</span>(sstate, n), n) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;State&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Respondents&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Responses by state&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;There are {df0 %&gt;% distinct(sstate) %&gt;% nrow()} states in the dataset&#39;</span>),
    <span class="dt">caption =</span> <span class="st">&#39;Source: http://www.people-press.org/2008/11/02/november-2008-election-weekend-survey/&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/state_count-1..svg" />
</figure>
<h3 id="ideology">Ideology</h3>
<p>Consulting the documentation, we see that liberality is given by the <code>ideo</code> column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df0 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(ideo) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Ideology&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Respondents&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Responses by ideology&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;There are {df0 %&gt;% distinct(ideo) %&gt;% nrow()} ideologies in the dataset&#39;</span>),
    <span class="dt">caption =</span> <span class="st">&#39;Source: http://www.people-press.org/2008/11/02/november-2008-election-weekend-survey/&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/ideo_count-1..svg" />
</figure>
<h3 id="obama-voters">Obama voters</h3>
<p>The data indicating vote is not so obvious. There is</p>
<ul>
<li>current voting preference in question 3, of which there are different versions for different states;</li>
<li>there are various columns derived from the survey responses to question 3, such as <code>q3horse</code>;</li>
<li>there is question 6 which asks for voting intention in November; and</li>
<li>there is a column called <code>obama</code> for which I couldn’t find any documentation.</li>
</ul>
<p>Despite the lack of documentation, I’ll run with <code>obama</code> since the responses seem to align better with the purpose of the exercise.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df0 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(obama) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Vote&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Respondents&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Responses by vote&#39;</span>,
    <span class="dt">subtitle =</span> <span class="kw">str_glue</span>(<span class="st">&#39;There are {df0 %&gt;% distinct(obama) %&gt;% nrow()} voting intentions in the dataset&#39;</span>),
    <span class="dt">caption =</span> <span class="st">&#39;Source data: http://www.people-press.org/2008/11/02/november-2008-election-weekend-survey/&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/vote_count-1..svg" />
</figure>
<h3 id="data-augmentation">Data augmentation</h3>
<p>In order to display two-letter abbreviations of the states, we use the data provided by the <code>state</code> package and join it to the Pew dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mapping &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">name =</span> <span class="kw">as_factor</span>(state.name, <span class="dt">levels =</span> <span class="kw">levels</span>(df<span class="op">$</span>sstate)), 
  <span class="dt">abbreviation =</span> state.abb
)

df &lt;-<span class="st"> </span>df0 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(mapping, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;sstate&#39;</span> =<span class="st"> &#39;name&#39;</span>))</code></pre></div>
<p>Here’s a sample from the mapping table.</p>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
abbreviation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Alabama
</td>
<td style="text-align:left;">
AL
</td>
</tr>
<tr>
<td style="text-align:left;">
Alaska
</td>
<td style="text-align:left;">
AK
</td>
</tr>
<tr>
<td style="text-align:left;">
Arizona
</td>
<td style="text-align:left;">
AZ
</td>
</tr>
<tr>
<td style="text-align:left;">
Arkansas
</td>
<td style="text-align:left;">
AR
</td>
</tr>
<tr>
<td style="text-align:left;">
California
</td>
<td style="text-align:left;">
CA
</td>
</tr>
<tr>
<td style="text-align:left;">
Colorado
</td>
<td style="text-align:left;">
CO
</td>
</tr>
</tbody>
</table>
<h2 id="ideology-vs.obama-voter">Ideology vs. Obama voter</h2>
<h3 id="raw-proportions">Raw proportions</h3>
<p>Let’s take a look at how the proportion of liberals relates to the proportion of Obama voters. There seems to be a positive relation, although the data are fairly noisy. Plotting the full range of values on the y-axis makes the noise more prominent. We only show the resticted range in order to show the individual state names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qa &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(sstate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">respondents =</span> <span class="kw">n</span>(),
    <span class="dt">liberals =</span> <span class="kw">sum</span>(ideo <span class="op">==</span><span class="st"> &#39;Very liberal&#39;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">liberal_proportion =</span> liberals <span class="op">/</span><span class="st"> </span>respondents,
    <span class="dt">obama_voters =</span> <span class="kw">sum</span>(obama <span class="op">==</span><span class="st"> &#39;Obama voter&#39;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">obama_vote_share =</span> obama_voters <span class="op">/</span><span class="st"> </span>respondents  
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(mapping, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;sstate&#39;</span> =<span class="st"> &#39;name&#39;</span>))

qa <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">y =</span> liberal_proportion, <span class="dt">x =</span> obama_vote_share) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> abbreviation, <span class="dt">alpha =</span> <span class="kw">log</span>(respondents)), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">hjust =</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">y =</span> <span class="st">&#39;Observed proportion of liberals&#39;</span>,
    <span class="dt">x =</span> <span class="st">&#39;Obama vote share&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Obama vote share vs liberal proportion for each state&#39;</span>,
    <span class="dt">subtitle =</span> <span class="st">&#39;The y-axis is truncated so that the labels are readable&#39;</span>,
    <span class="dt">caption =</span> <span class="st">&#39;Source data: http://www.people-press.org/2008/11/02/november-2008-election-weekend-survey/&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/state_liberal_vs_obama-1..svg" />
</figure>
<h3 id="posterior-inference">Posterior inference</h3>
<p>We’ll base our prior on the data (for convenience) and don’t take survey non-response issues into account. The pooled mean proportion of liberals will be our prior mean.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu &lt;-<span class="st"> </span><span class="kw">sum</span>(df<span class="op">$</span>ideo <span class="op">==</span><span class="st"> &#39;Very liberal&#39;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(df)
<span class="kw">percent</span>(mu)</code></pre></div>
<pre><code>[1] &quot;3.5%&quot;</code></pre>
<p>After trying various possibilities for the standard deviation <code>sigma</code>, the value below results in a prior that puts most of the density between 0% and 18%.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sigma &lt;-<span class="st"> </span><span class="fl">0.04</span>

shape &lt;-<span class="st"> </span>(mu <span class="op">/</span><span class="st"> </span>sigma)<span class="op">^</span><span class="dv">2</span>
rate &lt;-<span class="st"> </span>shape <span class="op">/</span><span class="st"> </span>mu

<span class="kw">tibble</span>(
    <span class="dt">prop =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.0005</span>),
    <span class="dt">density =</span> <span class="kw">dgamma</span>(prop, shape, rate)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(prop, density) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="dt">fill =</span> <span class="st">&#39;skyblue&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;white&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.3</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Proportion of liberals&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Density&#39;</span>,
    <span class="dt">title =</span> <span class="kw">str_glue</span>(<span class="kw">paste</span>(
      <span class="st">&#39;Gamma(shape = {signif(shape, digits = 2)}, rate = {signif(rate, digits = 2)})&#39;</span>,
      <span class="dt">sep =</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>
    ))
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/prior-1..svg" />
</figure>
<p>Let’s add the posterior means to our dataset and plot the them against proportion of Obama voters. In order to be visually comparable to the plot of observed data, we keep the limits of the axes the same.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qa_posterior &lt;-<span class="st"> </span>qa <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">posterior_shape =</span> shape <span class="op">+</span><span class="st"> </span>liberals,
    <span class="dt">posterior_rate =</span> rate <span class="op">+</span><span class="st"> </span>respondents,
    <span class="dt">posterior_mean =</span> posterior_shape <span class="op">/</span><span class="st"> </span>posterior_rate
  )

qa_posterior <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">y =</span> posterior_mean, <span class="dt">x =</span> obama_vote_share) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> abbreviation, <span class="dt">alpha =</span> <span class="kw">log</span>(respondents)), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">hjust =</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">y =</span> <span class="st">&#39;Posterior mean of proportion of liberals&#39;</span>,
    <span class="dt">x =</span> <span class="st">&#39;Obama vote share&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Obama vote share vs estimate of liberal proportion&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/posterior-1..svg" />
</figure>
<p>The posterior 95% credible intervals are shown below. Arizona and Louisianna seem to have a smaller proportional of liberals compared to the country average. Only Oregon’s credible interval is entirely above the country average.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qa_posterior <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">ci =</span> <span class="kw">map2</span>(
      posterior_shape, 
      posterior_rate, 
      <span class="cf">function</span>(s, r) 
        <span class="kw">tibble</span>(
          <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&#39;lower&#39;</span>, <span class="st">&#39;upper&#39;</span>),
          <span class="dt">value =</span> <span class="kw">qgamma</span>(<span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), s, r)
        ) 
    )
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(ci) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(type, value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> mu, <span class="dt">linetype =</span> <span class="st">&#39;dotted&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;orange&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="kw">reorder</span>(sstate, posterior_mean), posterior_mean) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">fatten =</span> <span class="fl">0.1</span>, <span class="dt">size =</span> <span class="fl">0.4</span>)  <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">y =</span> <span class="st">&#39;Posterior value&#39;</span>,
    <span class="dt">x =</span> <span class="st">&#39;State&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;95% credible intervals for the proportion of liberals per state&#39;</span>,
    <span class="dt">subtitle =</span> <span class="st">&#39;The pooled observed mean value is shown in orange&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/ci-1..svg" />
</figure>
<p>All of the states in which no liberals were observed had smaller sample sizes (below 50). The largest proportions were also observed in the states with sample sizes below 50. This plot looks fairly similar to the analogous plot for the cancer rate example, albeit with fewer data points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qa <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(respondents, liberal_proportion) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> abbreviation, <span class="dt">alpha =</span> <span class="kw">log</span>(respondents)), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">hjust =</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Number of respondents&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Observed proportion of liberals&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Observed proportion of liberals per state&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/observed_prop_vs_num_respondents-1..svg" />
</figure>
<p>The posterior estimates result in much less extreme values for the states with few respondents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qa_posterior <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(respondents, posterior_mean) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> abbreviation, <span class="dt">alpha =</span> <span class="kw">log</span>(respondents)), <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">hjust =</span> <span class="op">-</span><span class="fl">0.1</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&#39;Number of respondents&#39;</span>,
    <span class="dt">y =</span> <span class="st">&#39;Posterior mean of proportion of liberals&#39;</span>,
    <span class="dt">title =</span> <span class="st">&#39;Posterior proportion of liberals by state&#39;</span>
  )</code></pre></div>
<figure>
<img src="chapter_02_exercise_21_files/figure-markdown/posterior_prop_vs_num_respondents-1..svg" />
</figure>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 20</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_20.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_20.html</id>
    <published>2018-09-08T00:00:00Z</published>
    <updated>2018-09-08T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 20</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  8, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/exponential.html">exponential</a>, <a href="/tags/gamma.html">gamma</a>, <a href="/tags/truncated%0Aobservations.html">truncated
observations</a>, <a href="/tags/posterior%20variance.html">posterior variance</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 20, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial} \DeclareMathOperator{\dbern}{Bernoulli} \DeclareMathOperator{\dpois}{Poisson} \DeclareMathOperator{\dnorm}{Normal} \DeclareMathOperator{\dcauchy}{Cauchy} \DeclareMathOperator{\dexponential}{Exp} \DeclareMathOperator{\dgamma}{Gamma} \DeclareMathOperator{\dinvgamma}{InvGamma} \DeclareMathOperator{\invlogit}{InvLogit} \DeclareMathOperator{\logit}{Logit} \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Suppose <span class="math inline">\(y \mid \theta \sim \dexponential(\theta)\)</span> with prior <span class="math inline">\(\theta \sim \dgamma(\alpha, \beta)\)</span>. If we observe that <span class="math inline">\(y \ge 100\)</span>, then the posterior is</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\theta \mid y \ge 100)
  &amp;\propto
  \theta^{\alpha - 1} e^{-\beta \theta}
  \int_{y = 100}^\infty \theta e^{-\theta y} dy
  \\
  &amp;=
  \theta^{\alpha - 1} e^{-\beta \theta}
  \left[ (-1) e^{-\theta y}  \right]_{100}^\infty
  \\
  &amp;=
  \theta^{\alpha - 1} e^{-\beta \theta}
  e^{-100\theta}
  \\
  &amp;=
  \theta^{\alpha - 1} e^{-(\beta + 100) \theta}
  ,
\end{align}
\]</span></p>
<p>which is a <span class="math inline">\(\dgamma(\alpha, \beta + 100)\)</span> distribution. The posterior mean is <span class="math inline">\(\frac{\alpha}{\beta + 100}\)</span> and the posterior variance is <span class="math inline">\(\frac{\alpha}{(\beta + 100)^2}\)</span>.</p>
<p>If instead we had observed <span class="math inline">\(y = 100\)</span>, the posterior would have been</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\theta \mid y = 100)
  &amp;\propto
  \theta^{\alpha - 1} e^{-\beta \theta}
  \theta e^{-\theta 100} 
  \\
  &amp;=
  \theta^{\alpha} e^{-(\beta + 100) \theta}
  ,
\end{align}
\]</span></p>
<p>which is a <span class="math inline">\(\dgamma(\alpha + 1, \beta + 100)\)</span> distribution. The posterior mean here is <span class="math inline">\(\frac{\alpha + 1}{\beta + 100}\)</span> and the posterior variance is <span class="math inline">\(\frac{\alpha + 1}{(\beta + 100)^2}\)</span>.</p>
<p>Both of these estimates are greater than in the case of observing <span class="math inline">\(y \ge 100\)</span>. This is surprising because knowing that <span class="math inline">\(y = 100\)</span> is more informative than just knowing <span class="math inline">\(y \ge 100\)</span>. The reason there is actually less variance when <span class="math inline">\(y \ge 100\)</span> is that we get to average over all possibilities of <span class="math inline">\(y \ge 100\)</span>, and the case <span class="math inline">\(y = 100\)</span> has the greatest variance of all these possibilities.</p>
<p>We can illustrate this idea more formally using identity (2.8). In the context of this exercise, the identity can be written</p>
<p class="mathjaxWide"><span class="math display">\[
\mathbb V \left(\theta \mid y \ge 100 \right)
\ge
\mathbb E \left( \mathbb V \left(\theta \mid y \right) \mid y \ge 100 \right)
,
\]</span></p>
<p>where all the probabilities are now conditional on <span class="math inline">\(y \ge 100\)</span>. The left hand side is the posterior variance given <span class="math inline">\(y \ge 100\)</span>, which we calculated above to be <span class="math inline">\(\frac{\alpha}{(\beta + 100)^2}\)</span>. The quantity <span class="math inline">\(\mathbb E ( \mathbb V (\theta \mid y = 100) \mid y \ge 100)\)</span> is just <span class="math inline">\(\frac{\alpha + 1}{(\beta + 100)^2}\)</span> as shown above, which is greater than the LHS. However, this quantity is fundamentally different to what the right hand side of the identity expresses. The RHS actually evaluates to</p>
<p class="mathjaxWide"><span class="math display">\[
\int_{100}^\infty \frac{\alpha}{(\beta + \tilde y)^2} p(\tilde y \mid y \ge 100) d\tilde y.
\]</span></p>
<p>That is, it averages over all possible realisations of the variance given <span class="math inline">\(y \ge 100\)</span>. The inequality only guarantees that the posterior variance is <em>on average</em> smaller than the prior variance, so we can’t just plug in one value of interest.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 19</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_19.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_19.html</id>
    <published>2018-09-08T00:00:00Z</published>
    <updated>2018-09-08T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 19</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  8, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/gamma.html">gamma</a>, <a href="/tags/exponential.html">exponential</a>, <a href="/tags/conjugate%20prior.html">conjugate prior</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 19, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{Binomial}  \DeclareMathOperator{\dbern}{Bernoulli}  \DeclareMathOperator{\dpois}{Poisson}  \DeclareMathOperator{\dnorm}{Normal}  \DeclareMathOperator{\dcauchy}{Cauchy}  \DeclareMathOperator{\dexponential}{Exp}  \DeclareMathOperator{\dgamma}{Gamma}  \DeclareMathOperator{\dinvgamma}{InvGamma}  \DeclareMathOperator{\invlogit}{InvLogit}  \DeclareMathOperator{\logit}{Logit}  \DeclareMathOperator{\dbeta}{Beta}\)</span></p>
</div>
<p>Let’s show that the gamma distribution is conjugate to the exponential distribution. That is, we suppose <span class="math inline">\(y \mid \theta \sim \dexponential(\theta)\)</span> with prior <span class="math inline">\(\theta \sim \dgamma(\alpha, \beta)\)</span>, and show that the posterior is also gamma distributed.</p>
<p>The posterior is</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\theta \mid y)
  &amp;\propto
  \theta^n e^{-\theta \sum_1^n y_i} \cdot \theta^{\alpha - 1} e^{-\beta \theta}
  \\
  &amp;=
  \theta^{n + \alpha - 1} e^{-\theta \left(\beta + \sum_1^n y_i \right)}
\end{align}
\]</span></p>
<p>which implies <span class="math inline">\(\theta \mid y \sim \dgamma(\alpha + n, \beta + \sum_1^n y_i)\)</span>.</p>
<p>Suppose now that we wish to do inference on <span class="math inline">\(\phi := \theta^{-1}\)</span>. We will show that <span class="math inline">\(\phi\)</span> has an inverse gamma distribution if <span class="math inline">\(\theta\)</span> has a gamma distribution. Indeed,</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\phi)
  &amp;\propto
  p(\theta) \left\vert {\frac{d\phi}{d\theta}} \right\vert^{-1}
  \\
  &amp;=
  \theta^{\alpha - 1} e^{-\beta \theta} \cdot\theta^2
  \\
  &amp;=
  \phi^{-\alpha - 1} e^{-\frac{\beta}{\phi}}
  ,
\end{align}
\]</span></p>
<p>which corresponds to an <span class="math inline">\(\dinvgamma(\alpha, \beta)\)</span> distribution.</p>
<p>Suppose that the lifetime of a light bulb can be modelled as an exponential distribution with rate <span class="math inline">\(\theta\)</span>. Let’s compare inferences using the two different parameterisations above. For <span class="math inline">\(\theta \sim \dgamma(\alpha, \beta)\)</span>, the prior variance is <span class="math inline">\(\frac{\alpha}{\beta^2}\)</span> and the mean is <span class="math inline">\(\frac{\alpha}{\beta}\)</span>, so the prior coefficient of variation is <span class="math inline">\(\alpha^{-\frac{1}{2}}\)</span>. We are given that the prior coefficient of variation is 0.5, so <span class="math inline">\(\alpha = 4\)</span>. The posterior coefficient of variation is <span class="math inline">\((4 + n)^{-\frac{1}{2}}\)</span>. If we wish this to be at most 0.1, then we would need to test at least <span class="math inline">\(n = 96\)</span> light bulbs.</p>
<p>For <span class="math inline">\(\phi \sim \dinvgamma(\alpha, \beta)\)</span>, the prior variance is</p>
<p class="mathjaxWide"><span class="math display">\[
\frac{\beta^2}{(\alpha - 1)^2 (\alpha - 2)}
\]</span></p>
<p>and the mean is <span class="math inline">\(\frac{\beta}{\alpha - 1}\)</span>, so the prior coefficient of variation is <span class="math inline">\((\alpha - 2)^{-\frac{1}{2}}\)</span>. With a prior coefficient of variation is 0.5, we have <span class="math inline">\(\alpha = 6\)</span>. The posterior coefficient of variation is <span class="math inline">\((6 + n)^{-\frac{1}{2}}\)</span>. If we wish this to be at most 0.1, then we would need to test at least <span class="math inline">\(n = 94\)</span> light bulbs.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 18</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_18.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_18.html</id>
    <published>2018-09-08T00:00:00Z</published>
    <updated>2018-09-08T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 18</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  8, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/gamma.html">gamma</a>, <a href="/tags/poisson.html">poisson</a>, <a href="/tags/conjugate%20prior.html">conjugate prior</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 18, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{binomial}  \DeclareMathOperator{\dbern}{Bernoulli}  \DeclareMathOperator{\dpois}{Poisson}  \DeclareMathOperator{\dnorm}{normal}  \DeclareMathOperator{\dcauchy}{Cauchy}  \DeclareMathOperator{\dgamma}{gamma}  \DeclareMathOperator{\invlogit}{invlogit}  \DeclareMathOperator{\logit}{logit}  \DeclareMathOperator{\dbeta}{beta}\)</span></p>
</div>
<p>Suppose we have <span class="math inline">\(n\)</span> observations from a Poisson likelihood, <span class="math inline">\(y_i \mid \theta \sim \dpois(x_i\theta)\)</span>, with rate <span class="math inline">\(\theta\)</span> and exposure <span class="math inline">\(x_i\)</span>. We show that with a gamma prior, <span class="math inline">\(\theta \sim \dgamma(\alpha, \beta)\)</span>, the posterior also has a gamma distribution.</p>
<p>As shown in the book, the likelihood and prior are</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
p (y \mid \theta)
&amp;\propto
\theta^{\sum_1^n y_i} e^{-\theta \sum_i^n x_i}
\\
p(\theta)
&amp;\propto
\theta^{\alpha - 1} e^{-\beta \theta}
.
\end{align}
\]</span></p>
<p>Thus the posterior is</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
p (\theta \mid y)
&amp;\propto
\theta^{\sum_1^n y_i} e^{-\theta \sum_i^n x_i}
\cdot
\theta^{\alpha - 1} e^{-\beta \theta}
\\
&amp;=
\theta^{\alpha - 1 + \sum_1^n y_i}
e^{-\theta \left( \beta + \sum_1^n x_i \right)}
,
\end{align}
\]</span></p>
<p>which shows that <span class="math inline">\(p(\theta \mid y) \sim \dgamma(\alpha + \sum_1^n y_i, \beta + \sum_1^n x_i)\)</span>.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 17</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_17.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_17.html</id>
    <published>2018-09-08T00:00:00Z</published>
    <updated>2018-09-08T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 17</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  8, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/chi2.html">chi2</a>, <a href="/tags/highest%20posterior%20interval.html">highest posterior interval</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 17, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{binomial}  \DeclareMathOperator{\dbern}{Bernoulli}  \DeclareMathOperator{\dpois}{Poisson}  \DeclareMathOperator{\dnorm}{normal}  \DeclareMathOperator{\dcauchy}{Cauchy}  \DeclareMathOperator{\dgamma}{gamma}  \DeclareMathOperator{\invlogit}{invlogit}  \DeclareMathOperator{\logit}{logit}  \DeclareMathOperator{\dbeta}{beta}\)</span></p>
</div>
<p>We’ll show that highest posterior invervals are not invariant under parameter transformations.</p>
<p>Suppose <span class="math inline">\(\frac{nv}{\sigma^2} \mid \sigma^2 \sim \chi_n^2\)</span> with (improper) prior <span class="math inline">\(\sigma \propto \sigma^{-1}\)</span>. From equation (2.19), page 52, the prior density for <span class="math inline">\(\sigma^2\)</span> is</p>
<p class="mathjaxWide"><span class="math display">\[
p(\sigma^2) 
=
p(\sigma) (2\sigma)^{-1}
\propto
\frac{1}{\sigma^2}
.
\]</span></p>
<p>Thus the posteriors are</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(\sigma^2 \mid y) 
  &amp;=
  \left( \frac{1}{\sigma} \right)^n e^{\frac{-nv}{2 \sigma^2}}
  \\
  p(\sigma \mid y) 
  &amp;=
  \left( \frac{1}{\sigma} \right)^{n - 1} e^{\frac{-nv}{2 \sigma^2}}
  ,
\end{align}
\]</span></p>
<p>where we have dropped any multiplicative constants that don’t depend on <span class="math inline">\(\sigma\)</span>.</p>
<p>Since the posteriors are continuous everywhere, we can assume that the highest posterior regions are collections of closed intervals. Let <span class="math inline">\(a, b\)</span> be two boundary points on the highest posterior density region of <span class="math inline">\(p(\sigma^2 \mid y)\)</span>. Using continuity and the defining property of highest posterior regions, the density at <span class="math inline">\(a\)</span> is equal to the density at <span class="math inline">\(b\)</span>, i.e.</p>
<p class="mathjaxWide"><span class="math display">\[
\left( \frac{1}{a} \right)^n e^{\frac{-nv}{2 a^2}}
=
\left( \frac{1}{b} \right)^n e^{\frac{-nv}{2 b^2}}
.
\]</span></p>
<p>Assume for contradiction that the highest posterior region for <span class="math inline">\(p(\sigma \mid y)\)</span> is the square root of the region for <span class="math inline">\(p(\sigma^2 \mid y)\)</span>. Then by continuity, <span class="math inline">\(\sqrt{a}, \sqrt{b}\)</span> are endpoints on the highest posterior region for <span class="math inline">\(p(\sigma \mid y)\)</span>. Thus</p>
<p class="mathjaxWide"><span class="math display">\[
\left( \frac{1}{a} \right)^{n - 1} e^{\frac{-nv}{2 a^2}}
=
\left( \frac{1}{b} \right)^{n - 1} e^{\frac{-nv}{2 b^2}}
.
\]</span></p>
<p>The two equalities above are equivalent to <span class="math inline">\(\frac{1}{a} = \frac{1}{b}\)</span>, which implies</p>
<p class="mathjaxWide"><span class="math display">\[
a = b
\qquad
↯
\]</span></p>
<p>This is true of any two boundary points, so the highest posterior region is a point. This contradicts the fact that the highest posterior region contains 95% probability mass. Therefore, the highest posterior regions are not invariant under reparameterisation.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 16</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_16.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_16.html</id>
    <published>2018-09-06T00:00:00Z</published>
    <updated>2018-09-06T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 16</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  6, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/beta-binomial.html">beta-binomial</a>, <a href="/tags/marginal.html">marginal</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 16, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{binomial}  \DeclareMathOperator{\dbern}{Bernoulli}  \DeclareMathOperator{\dpois}{Poisson}  \DeclareMathOperator{\dnorm}{normal}  \DeclareMathOperator{\dcauchy}{Cauchy}  \DeclareMathOperator{\dgamma}{gamma}  \DeclareMathOperator{\invlogit}{invlogit}  \DeclareMathOperator{\logit}{logit}  \DeclareMathOperator{\dbeta}{beta}\)</span></p>
</div>
<p>Suppose <span class="math inline">\(y \mid \theta \sim \dbinomial(n, \theta)\)</span> and <span class="math inline">\(\theta \sim \dbeta(\alpha, \beta)\)</span>. Then</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  p(y)
  &amp;=
  \int_0^1 p(y \mid \theta) p(\theta) d\theta
  \\
  &amp;=
  \int_0^1 \binom{n}{y} \theta^y (1 - \theta)^{n - y} \theta^{\alpha - 1} (1 - \theta)^{\beta - 1} d\theta
  \\
  &amp;=
  \binom{n}{y} \frac{\Gamma (y + \alpha) \Gamma (n - y + \beta)}{\Gamma (n + \alpha + \beta)}
.
\end{align}
\]</span></p>
<p>If this density is constant in <span class="math inline">\(y\)</span> for any <span class="math inline">\(n\)</span>, then</p>
<p class="mathjaxWide"><span class="math display">\[
\binom{n}{y} \Gamma (y + \alpha) \Gamma (n - y + \beta) 
\]</span></p>
<p>is also constant in <span class="math inline">\(y\)</span> for any <span class="math inline">\(n\)</span>. In particular, for <span class="math inline">\(n = 1\)</span>, we can evaulate this at <span class="math inline">\(y = 0\)</span> and <span class="math inline">\(y = n\)</span> to give</p>
<p class="mathjaxWide"><span class="math display">\[
\Gamma (\alpha) \Gamma (1 + \beta) 
=
\Gamma (\beta) \Gamma (1 + \alpha) 
.
\]</span></p>
<p><a href="https://en.wikipedia.org/wiki/Gamma_function">Since</a> <span class="math inline">\(\Gamma (1 + \alpha) = \alpha \Gamma(\alpha)\)</span>, it follows that</p>
<p class="mathjaxWide"><span class="math display">\[
\beta \Gamma (\alpha) \Gamma (\beta)
=
\alpha \Gamma (\alpha) \Gamma (\beta)
.
\]</span></p>
<p>Using the fact that the gamma function is always positive on the reals, we can conclude <span class="math inline">\(\alpha = \beta\)</span>.</p>
<p>Now, for <span class="math inline">\(n = 2\)</span>, we can evaluate at <span class="math inline">\(y = 0\)</span> and <span class="math inline">\(y = 1\)</span> to get</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
\Gamma(\alpha) \Gamma(\alpha + 2)
&amp;=
2 \Gamma(\alpha + 1)^2
\\
\Leftrightarrow
(\alpha + 1) \alpha \Gamma (\alpha)^2
&amp;=
2 \alpha^2 \Gamma (\alpha)^2
\\
\Leftrightarrow
\alpha + 1 
&amp;= 
2\alpha
\\
\Leftrightarrow
\alpha 
&amp;=
1
\end{align}
,
\]</span></p>
<p>where we have used the facts that <span class="math inline">\(\alpha &gt; 0\)</span>, <span class="math inline">\(\Gamma(\alpha + 1) = \alpha \Gamma(\alpha)\)</span>, and that the gamma function is positive on the reals. Therefore, <span class="math inline">\(\alpha = \beta = 1\)</span>. In other words, if the beta-binomial distribution is uniform, then <span class="math inline">\(\alpha = \beta = 1\)</span>.</p>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>
<entry>
    <title>BDA3 Chapter 2 Exercise 15</title>
    <link href="http://stappit.github.io/posts/bda3/chapter_02_exercise_15.html" />
    <id>http://stappit.github.io/posts/bda3/chapter_02_exercise_15.html</id>
    <published>2018-09-04T00:00:00Z</published>
    <updated>2018-09-04T00:00:00Z</updated>
    <summary type="html"><![CDATA[<h1 class="post-title">BDA3 Chapter 2 Exercise 15</h1>

<div class="card post-meta border-0">
  <div class="card-body post-meta">
    <p class="card-text text-muted text-left">
    Posted on September  4, 2018  by Brian </br>
     Tags: <a href="/tags/bda%20chapter%202.html">bda chapter 2</a>, <a href="/tags/solutions.html">solutions</a>, <a href="/tags/bayes.html">bayes</a>, <a href="/tags/beta.html">beta</a>, <a href="/tags/mean.html">mean</a>, <a href="/tags/variance.html">variance</a> </br>
     Category: <a href="/categories/bda3.html">bda3</a> 
    </p>
  </div>
</div>

<p>Here’s my solution to exercise 15, chapter 2, of <a href="https://andrewgelman.com/">Gelman’s</a> <em>Bayesian Data Analysis</em> (BDA), 3rd edition. There are <a href="http://www.stat.columbia.edu/~gelman/book/solutions.pdf">solutions</a> to some of the exercises on the <a href="http://www.stat.columbia.edu/~gelman/book/">book’s webpage</a>.</p>
<!--more-->
<div style="display:none">
<p class="mathjaxWide"><span class="math inline">\(\DeclareMathOperator{\dbinomial}{binomial}  \DeclareMathOperator{\dbern}{Bernoulli}  \DeclareMathOperator{\dpois}{Poisson}  \DeclareMathOperator{\dnorm}{normal}  \DeclareMathOperator{\dcauchy}{Cauchy}  \DeclareMathOperator{\dgamma}{gamma}  \DeclareMathOperator{\invlogit}{invlogit}  \DeclareMathOperator{\logit}{logit}  \DeclareMathOperator{\dbeta}{beta}\)</span></p>
</div>
<p>Suppose <span class="math inline">\(Z \sim \dbeta(\alpha, \beta)\)</span>. Then for <span class="math inline">\(m, n \in \mathbb N\)</span> we have</p>
<p class="mathjaxWide"><span class="math display">\[
\begin{align}
  \mathbb E \left[ Z^m (1 - Z)^n \right]
  &amp;=
  \frac{1}{B(\alpha, \beta)} \int_0^1 z^m (1 - z)^n z^{\alpha - 1} (1 - z)^{\beta - 1} dz
  \\
  &amp;=
  \frac{1}{B(\alpha, \beta)} \int_0^1 z^{m + \alpha - 1} (1 - z)^{n + \beta - 1} dz
  \\
  &amp;=
  \frac{1}{B(\alpha, \beta)} \frac{\Gamma (m + \alpha) \Gamma( n + \beta )}{\Gamma (m + n + \alpha + \beta)}
  \\
  &amp;=
  \frac{(\alpha + \beta -1)!}{(\alpha - 1)! (\beta - 1)!} \frac{(m + \alpha - 1)! (n + \beta - 1)!}{(m + n + \alpha + \beta - 1)!}
  ,
\end{align}
\]</span></p>
<p>where <span class="math inline">\(B\)</span> is the <a href="https://en.wikipedia.org/wiki/Gamma_function">beta function</a> and <span class="math inline">\(\Gamma\)</span> is the <a href="https://en.wikipedia.org/wiki/Gamma_function">gamma function</a>.</p>
<p>I’m not sure how the above integral is so useful for this exercise since calculating the mean and variance only require <span class="math inline">\(n = 0\)</span> and <span class="math inline">\(m = 1, 2\)</span>.</p>
<p>The mean of <span class="math inline">\(Z\)</span> is the above expectation when <span class="math inline">\(m = 1\)</span> and <span class="math inline">\(n = 0\)</span>, giving</p>
<p class="mathjaxWide"><span class="math display">\[
\mathbb E (Z)
=
\frac{(\alpha + \beta - 1)!}{(\alpha - 1)! (\beta - 1)!}
\frac{\alpha! (\beta - 1)!}{(\alpha + \beta)!}
=
\frac{\alpha}{\alpha + \beta}
.
\]</span></p>
<p>The second moment is given by <span class="math inline">\(m = 2\)</span> and <span class="math inline">\(n = 0\)</span>, which is</p>
<p class="mathjaxWide"><span class="math display">\[
\mathbb E(Z^2)
=
\frac{(\alpha + \beta - 1)!}{(\alpha - 1)! (\beta - 1)!}
\frac{(\alpha +1)! (\beta - 1)!}{(\alpha + \beta + 1)!}
=
\frac{(\alpha + 1) \alpha}{(\alpha + \beta + 1) (\alpha + \beta)}
.
\]</span></p>
<p>It follows that the variance is</p>
<span class="math display">\[\begin{align}
  \mathbb E (Z^2) - \mathbb E (Z)^2
  &amp;=
  \frac{(\alpha + 1) \alpha}{(\alpha + \beta + 1) (\alpha + \beta)}
  -
  \frac{\alpha^2}{(\alpha + \beta)^2}
  
  \\
  &amp;=
  
  \frac{(\alpha + 1) \alpha (\alpha + \beta)}{(\alpha + \beta + 1) (\alpha + \beta)^2}
  -
  \frac{\alpha^2(\alpha + \beta + 1)}{(\alpha + \beta + 1) (\alpha + \beta)^2}
  
  \\
  &amp;=
  
  \frac{
    \alpha^2 (\alpha + \beta) + \alpha (\alpha + \beta)
    -
    \alpha^2(\alpha + \beta) - \alpha^2
  }{(\alpha + \beta + 1) (\alpha + \beta)^2}
  
  \\
  &amp;=
  
  \frac{
    \alpha (\alpha + \beta)
    -
    \alpha^2
  }{(\alpha + \beta + 1) (\alpha + \beta)^2}
  \\
  &amp;=
  
  \frac{
    \alpha \beta
  }{(\alpha + \beta + 1) (\alpha + \beta)^2}
  .
\end{align}\]</span>

<div id="disqus_thread"></div>
<script>
/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
 */
/*
   var disqus_config = function () {
   this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
   };
 */
(function() {  // DON'T EDIT BELOW THIS LINE
 var d = document, s = d.createElement('script');

 s.src = '//stappit-github-io.disqus.com/embed.js';

 s.setAttribute('data-timestamp', +new Date());
 (d.head || d.body).appendChild(s);
 })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//stappit-github-io.disqus.com/count.js" async></script>
]]></summary>
</entry>

</feed>
